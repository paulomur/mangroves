<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>2 Mapping mangroves using Sentinel1&amp;2 | Mapping mangroves using remote sensing</title>
  <meta name="description" content="2 Mapping mangroves using Sentinel1&amp;2 | Mapping mangroves using remote sensing" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="2 Mapping mangroves using Sentinel1&amp;2 | Mapping mangroves using remote sensing" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="2 Mapping mangroves using Sentinel1&amp;2 | Mapping mangroves using remote sensing" />
  
  
  

<meta name="author" content="Paulo J. Murillo-Sandoval" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html"/>
<link rel="next" href="mapping-mangroves-using-landsat.html"/>
<script src="libs/header-attrs-2.7/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Mangroves Science</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Overview</a></li>
<li class="chapter" data-level="2" data-path="mapping-mangroves-using-sentinel12.html"><a href="mapping-mangroves-using-sentinel12.html"><i class="fa fa-check"></i><b>2</b> Mapping mangroves using Sentinel1&amp;2</a>
<ul>
<li class="chapter" data-level="2.1" data-path="mapping-mangroves-using-sentinel12.html"><a href="mapping-mangroves-using-sentinel12.html#preprocessingexporting-sentinel-1-and-sentinel-2"><i class="fa fa-check"></i><b>2.1</b> Preprocessing/Exporting Sentinel-1 and Sentinel-2</a></li>
<li class="chapter" data-level="2.2" data-path="mapping-mangroves-using-sentinel12.html"><a href="mapping-mangroves-using-sentinel12.html#organizing-a-basemap-get-training-data"><i class="fa fa-check"></i><b>2.2</b> Organizing a basemap (get training data)</a></li>
<li class="chapter" data-level="2.3" data-path="mapping-mangroves-using-sentinel12.html"><a href="mapping-mangroves-using-sentinel12.html#indices-and-an-object-based-classifier"><i class="fa fa-check"></i><b>2.3</b> Indices and an object-based classifier</a></li>
<li class="chapter" data-level="2.4" data-path="mapping-mangroves-using-sentinel12.html"><a href="mapping-mangroves-using-sentinel12.html#accuracy-and-cleaning-the-final-product"><i class="fa fa-check"></i><b>2.4</b> Accuracy and cleaning the final product</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="mapping-mangroves-using-landsat.html"><a href="mapping-mangroves-using-landsat.html"><i class="fa fa-check"></i><b>3</b> Mapping mangroves using Landsat</a>
<ul>
<li class="chapter" data-level="3.1" data-path="mapping-mangroves-using-landsat.html"><a href="mapping-mangroves-using-landsat.html#making-fitted-values-using-landsat-archive"><i class="fa fa-check"></i><b>3.1</b> Making fitted values using Landsat archive</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="mapping-mangroves-using-landsat.html"><a href="mapping-mangroves-using-landsat.html#remove-bad-imagery"><i class="fa fa-check"></i><b>3.1.1</b> Remove bad imagery</a></li>
<li class="chapter" data-level="3.1.2" data-path="mapping-mangroves-using-landsat.html"><a href="mapping-mangroves-using-landsat.html#input-parameters-1"><i class="fa fa-check"></i><b>3.1.2</b> Input parameters (1)</a></li>
<li class="chapter" data-level="3.1.3" data-path="mapping-mangroves-using-landsat.html"><a href="mapping-mangroves-using-landsat.html#input-parameters-2"><i class="fa fa-check"></i><b>3.1.3</b> Input parameters (2)</a></li>
<li class="chapter" data-level="3.1.4" data-path="mapping-mangroves-using-landsat.html"><a href="mapping-mangroves-using-landsat.html#adding-percentiles"><i class="fa fa-check"></i><b>3.1.4</b> Adding percentiles</a></li>
<li class="chapter" data-level="3.1.5" data-path="mapping-mangroves-using-landsat.html"><a href="mapping-mangroves-using-landsat.html#exporting-assets"><i class="fa fa-check"></i><b>3.1.5</b> Exporting assets</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="mapping-mangroves-using-landsat.html"><a href="mapping-mangroves-using-landsat.html#building-3-years-landcover-maps"><i class="fa fa-check"></i><b>3.2</b> Building 3-years landcover maps</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="mapping-mangroves-using-landsat.html"><a href="mapping-mangroves-using-landsat.html#reading-landsat-spectral-data-and-stratified-sampling"><i class="fa fa-check"></i><b>3.2.1</b> Reading Landsat spectral data and stratified sampling</a></li>
<li class="chapter" data-level="3.2.2" data-path="mapping-mangroves-using-landsat.html"><a href="mapping-mangroves-using-landsat.html#apply-snic"><i class="fa fa-check"></i><b>3.2.2</b> Apply SNIC</a></li>
<li class="chapter" data-level="3.2.3" data-path="mapping-mangroves-using-landsat.html"><a href="mapping-mangroves-using-landsat.html#tunning-for-the-amount-of-trees"><i class="fa fa-check"></i><b>3.2.3</b> Tunning for the amount of trees</a></li>
<li class="chapter" data-level="3.2.4" data-path="mapping-mangroves-using-landsat.html"><a href="mapping-mangroves-using-landsat.html#apply-snic-and-export-each-land-cover-map"><i class="fa fa-check"></i><b>3.2.4</b> Apply SNIC and export each land cover map</a></li>
<li class="chapter" data-level="3.2.5" data-path="mapping-mangroves-using-landsat.html"><a href="mapping-mangroves-using-landsat.html#maps-visualization"><i class="fa fa-check"></i><b>3.2.5</b> Maps visualization</a></li>
<li class="chapter" data-level="3.2.6" data-path="mapping-mangroves-using-landsat.html"><a href="mapping-mangroves-using-landsat.html#limitations"><i class="fa fa-check"></i><b>3.2.6</b> Limitations</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://mangrovescience.org/"</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Mapping mangroves using remote sensing</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="mapping-mangroves-using-sentinel12" class="section level1" number="2">
<h1><span class="header-section-number">2</span> Mapping mangroves using Sentinel1&amp;2</h1>
<p>I used Colombia as study region for this analysis. However, the method can be applied everywhere. The steps to map mangroves and other common land cover classes are:</p>
<ol style="list-style-type: decimal">
<li>Pre-processing/Exporting Sentinel-1 and Sentinel-2</li>
<li>Organizing a basemap (get training data!!!)</li>
<li>Applying an object-based classifier</li>
</ol>
<p>All previous steps can be easily modified for specific regions and conditions.</p>
<p>First thing is adding the repository to your Earth Engine account:</p>
<p><span target="_blank"><a href="https://code.earthengine.google.com/?accept_repo=users/murillop/mapping_mangroves" class="uri">https://code.earthengine.google.com/?accept_repo=users/murillop/mapping_mangroves</a></span></p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="mapping-mangroves-using-sentinel12.html#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># and call the main library:</span></span>
<span id="cb1-2"><a href="mapping-mangroves-using-sentinel12.html#cb1-2" aria-hidden="true" tabindex="-1"></a>var man <span class="ot">=</span> <span class="fu">require</span>(<span class="st">&#39;users/murillop/mapping_mangroves:mangroves&#39;</span>);</span></code></pre></div>
<p>In that the repository you can find the main library plus the examples to run the analysis.</p>
<div id="preprocessingexporting-sentinel-1-and-sentinel-2" class="section level2" number="2.1">
<h2><span class="header-section-number">2.1</span> Preprocessing/Exporting Sentinel-1 and Sentinel-2</h2>
<p>Preprocessing data from S1 requires the effective removal of speckle noise. We use Perona-Malik filter to remove speckle for each image.</p>
<p>For Sentinel-2 we remove clouds and shadows. All functions allows to obtain better spectral information for the period 2019-2020.</p>
<p>After improving the data, a image composite using the “median”. We also –&gt;
calculate the standard deviation and percentiles 20th and 80th.
Finally we save the resulting composite as an asset.</p>
<p>The only parameter needed are:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="mapping-mangroves-using-sentinel12.html#cb2-1" aria-hidden="true" tabindex="-1"></a>var man <span class="ot">=</span> <span class="fu">require</span>(<span class="st">&#39;users/murillop/mapping_mangroves:mangroves&#39;</span>);</span>
<span id="cb2-2"><a href="mapping-mangroves-using-sentinel12.html#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="mapping-mangroves-using-sentinel12.html#cb2-3" aria-hidden="true" tabindex="-1"></a>var region <span class="ot">=</span>  <span class="fu">ee.Geometry.Polygon</span>(</span>
<span id="cb2-4"><a href="mapping-mangroves-using-sentinel12.html#cb2-4" aria-hidden="true" tabindex="-1"></a>        [[[<span class="sc">-</span><span class="fl">78.63099738574668</span>, <span class="fl">2.746827033203151</span>],</span>
<span id="cb2-5"><a href="mapping-mangroves-using-sentinel12.html#cb2-5" aria-hidden="true" tabindex="-1"></a>          [<span class="sc">-</span><span class="fl">78.63099738574668</span>, <span class="fl">2.2295862108717603</span>],</span>
<span id="cb2-6"><a href="mapping-mangroves-using-sentinel12.html#cb2-6" aria-hidden="true" tabindex="-1"></a>          [<span class="sc">-</span><span class="fl">77.70677253223106</span>, <span class="fl">2.2295862108717603</span>],</span>
<span id="cb2-7"><a href="mapping-mangroves-using-sentinel12.html#cb2-7" aria-hidden="true" tabindex="-1"></a>          [<span class="sc">-</span><span class="fl">77.70677253223106</span>, <span class="fl">2.746827033203151</span>]]], null, false);</span>
<span id="cb2-8"><a href="mapping-mangroves-using-sentinel12.html#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="mapping-mangroves-using-sentinel12.html#cb2-9" aria-hidden="true" tabindex="-1"></a>var AOI <span class="ot">=</span> region; </span>
<span id="cb2-10"><a href="mapping-mangroves-using-sentinel12.html#cb2-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-11"><a href="mapping-mangroves-using-sentinel12.html#cb2-11" aria-hidden="true" tabindex="-1"></a>var params <span class="ot">=</span> {</span>
<span id="cb2-12"><a href="mapping-mangroves-using-sentinel12.html#cb2-12" aria-hidden="true" tabindex="-1"></a>START_DATE<span class="sc">:</span> <span class="st">&#39;2019-01-01&#39;</span>,</span>
<span id="cb2-13"><a href="mapping-mangroves-using-sentinel12.html#cb2-13" aria-hidden="true" tabindex="-1"></a>END_DATE<span class="sc">:</span> <span class="st">&#39;2021-01-01&#39;</span>,</span>
<span id="cb2-14"><a href="mapping-mangroves-using-sentinel12.html#cb2-14" aria-hidden="true" tabindex="-1"></a>CLOUD_FILTER <span class="sc">:</span> <span class="dv">60</span>,   <span class="co">#//CLOUDY_PIXEL_PERCENTAGE. Select less than 60%</span></span>
<span id="cb2-15"><a href="mapping-mangroves-using-sentinel12.html#cb2-15" aria-hidden="true" tabindex="-1"></a>CLD_PRB_THRESH <span class="sc">:</span> <span class="dv">20</span>, <span class="co">#//PROBABILITY greater than 20%</span></span>
<span id="cb2-16"><a href="mapping-mangroves-using-sentinel12.html#cb2-16" aria-hidden="true" tabindex="-1"></a>NIR_DRK_THRESH <span class="sc">:</span> <span class="fl">0.15</span>,  <span class="co">#//For shadows</span></span>
<span id="cb2-17"><a href="mapping-mangroves-using-sentinel12.html#cb2-17" aria-hidden="true" tabindex="-1"></a>CLD_PRJ_DIST <span class="sc">:</span> <span class="dv">1</span>,  <span class="co">#//Project shadows from clouds using distance =1</span></span>
<span id="cb2-18"><a href="mapping-mangroves-using-sentinel12.html#cb2-18" aria-hidden="true" tabindex="-1"></a>BUFFER <span class="sc">:</span> <span class="dv">50</span>   <span class="co">#//Buffer around clouds</span></span>
<span id="cb2-19"><a href="mapping-mangroves-using-sentinel12.html#cb2-19" aria-hidden="true" tabindex="-1"></a>};</span></code></pre></div>
<p>After modify your parameters you can apply the functions needed for pre-processing</p>
<p>Example:
Get all S2 images based on parameters.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="mapping-mangroves-using-sentinel12.html#cb3-1" aria-hidden="true" tabindex="-1"></a>var s2_sr_cld_col_eval <span class="ot">=</span> <span class="fu">man.get_s2_sr_cld_col</span>(AOI, params); </span>
<span id="cb3-2"><a href="mapping-mangroves-using-sentinel12.html#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span> (<span class="fu">s2_sr_cld_col_eval.size</span>(),<span class="st">&#39;number of S2 images&#39;</span>);</span></code></pre></div>
<p>and to apply cloud masking and shadow masking</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="mapping-mangroves-using-sentinel12.html#cb4-1" aria-hidden="true" tabindex="-1"></a>var s2 <span class="ot">=</span> <span class="fu">s2_sr_cld_col_eval.map</span>(<span class="cf">function</span>(img){return <span class="fu">man.add_cld_shdw_mask</span>(img, params)});</span>
<span id="cb4-2"><a href="mapping-mangroves-using-sentinel12.html#cb4-2" aria-hidden="true" tabindex="-1"></a>s2 <span class="ot">=</span><span class="fu">s2.map</span>(<span class="cf">function</span>(img){return <span class="fu">man.apply_cld_shdw_mask</span>(img, params)});</span></code></pre></div>
<p>See the rest of the script on the repository <strong>1.Export_S1_S2_composite</strong></p>
</div>
<div id="organizing-a-basemap-get-training-data" class="section level2" number="2.2">
<h2><span class="header-section-number">2.2</span> Organizing a basemap (get training data)</h2>
<p>Getting training data for a classification process is a exhausting task. Mostly visual and manually collected,
training data is key for a success classification process.Here we use previous maps created by Colombia Government from which we select specific land cover classes. The basemap follows the Corine Land Cover (CLC) methodology which is the official methodology employs by official Colombian agencies.
See official CLC documentation can be found <a href="http://documentacion.ideam.gov.co/openbiblio/bvirtual/021521/LIBROCORINEFINAL.pdf" target="_blank"><strong>here</strong></a></p>
<p>For this exercise, five classes were used:
1. Mangroves
2. Water
3. Dense Forest &gt;80% tree canopy cover
4. Non-forest &lt;20% tree canopy cover
5. Other vegetation (shrub, herbaceous, wet forest)</p>
<p>The code used <strong>2.Classification_S1_S2</strong> is located in the repository.</p>
<p>This function add specific land cover types.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="mapping-mangroves-using-sentinel12.html#cb5-1" aria-hidden="true" tabindex="-1"></a>var man <span class="ot">=</span> <span class="fu">require</span>(<span class="st">&#39;users/murillop/NASA_mangroves:mangroves&#39;</span>);</span>
<span id="cb5-2"><a href="mapping-mangroves-using-sentinel12.html#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Get Corine Land cover classes</span></span>
<span id="cb5-3"><a href="mapping-mangroves-using-sentinel12.html#cb5-3" aria-hidden="true" tabindex="-1"></a>var corine <span class="ot">=</span> <span class="fu">man.getCORINE</span>()</span></code></pre></div>
<p>The CLC is from 2012. I update this map using Hansen and JRC datasets for 2019.
This process helps to obtain classes more “pure” pixels, discard outliers and update them.</p>
<p>For instance in the case of mangroves class, I update the class taking into account the presence of water in S1 and forest/non-forest mask derived from Hansen.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="mapping-mangroves-using-sentinel12.html#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Update **manglar** class when it is water and when it is non-forest.</span></span>
<span id="cb6-2"><a href="mapping-mangroves-using-sentinel12.html#cb6-2" aria-hidden="true" tabindex="-1"></a>var manglar1 <span class="ot">=</span> <span class="fu">corine.select</span>(<span class="st">&#39;manglar&#39;</span>)</span>
<span id="cb6-3"><a href="mapping-mangroves-using-sentinel12.html#cb6-3" aria-hidden="true" tabindex="-1"></a>          <span class="fu">.updateMask</span>(<span class="fu">vv_water.eq</span>(<span class="dv">0</span>))  <span class="co">#//remove water</span></span>
<span id="cb6-4"><a href="mapping-mangroves-using-sentinel12.html#cb6-4" aria-hidden="true" tabindex="-1"></a>          <span class="fu">.updateMask</span>(<span class="fu">corine.select</span>(<span class="st">&#39;F-NF&#39;</span>)<span class="fu">.eq</span>(<span class="dv">1</span>))  <span class="co">#//remove when it is non-forest</span></span>
<span id="cb6-5"><a href="mapping-mangroves-using-sentinel12.html#cb6-5" aria-hidden="true" tabindex="-1"></a>          <span class="fu">.remap</span>([<span class="dv">0</span>],[<span class="dv">1</span>])<span class="fu">.int</span>()</span>
<span id="cb6-6"><a href="mapping-mangroves-using-sentinel12.html#cb6-6" aria-hidden="true" tabindex="-1"></a>          <span class="fu">.rename</span>(<span class="st">&#39;class&#39;</span>);</span></code></pre></div>
</div>
<div id="indices-and-an-object-based-classifier" class="section level2" number="2.3">
<h2><span class="header-section-number">2.3</span> Indices and an object-based classifier</h2>
<p>We calculate a set of different relevant spectral metrics from the exported asset. The code used <strong>2.Classification_S1_S2</strong>. Relevant vegetation indices and GLCM textural metrics for mapping mangroves were calculate.</p>
<p>To add them into the exported asset.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="mapping-mangroves-using-sentinel12.html#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="sc">/</span><span class="er">/</span><span class="co"># Read S1+S2</span></span>
<span id="cb7-2"><a href="mapping-mangroves-using-sentinel12.html#cb7-2" aria-hidden="true" tabindex="-1"></a>var s1_s2 <span class="ot">=</span> <span class="fu">ee.Image</span>(<span class="st">&quot;projects/mangrovescience/SilviaCarbon_COL/Sentinel_Predictors/s1_s2_2019-01-01_2021-01-01&quot;</span>)</span>
<span id="cb7-3"><a href="mapping-mangroves-using-sentinel12.html#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="sc">/</span><span class="er">/</span><span class="co"># Read S2 only and calculate different predictors (Indices+GLCM indicators)</span></span>
<span id="cb7-4"><a href="mapping-mangroves-using-sentinel12.html#cb7-4" aria-hidden="true" tabindex="-1"></a>var s2 <span class="ot">=</span><span class="fu">s1_s2.select</span>(<span class="st">&#39;B.*&#39;</span>);</span>
<span id="cb7-5"><a href="mapping-mangroves-using-sentinel12.html#cb7-5" aria-hidden="true" tabindex="-1"></a>s2 <span class="ot">=</span><span class="fu">man.doIndices2</span>(<span class="fu">ee.ImageCollection</span>(s2));</span></code></pre></div>
<p>Now we have S2 data, then we add S1 bands:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="mapping-mangroves-using-sentinel12.html#cb8-1" aria-hidden="true" tabindex="-1"></a>var s1 <span class="ot">=</span><span class="fu">ee.Image</span>(<span class="st">&quot;projects/mangrovescience/SilviaCarbon_COL/Sentinel_Predictors/s1_s2_2019-01-01_2021-01-01&quot;</span>)</span>
<span id="cb8-2"><a href="mapping-mangroves-using-sentinel12.html#cb8-2" aria-hidden="true" tabindex="-1"></a>          <span class="fu">.select</span>(<span class="st">&#39;VV&#39;</span>,<span class="st">&#39;VH&#39;</span>);</span>
<span id="cb8-3"><a href="mapping-mangroves-using-sentinel12.html#cb8-3" aria-hidden="true" tabindex="-1"></a>var s1s2_new <span class="ot">=</span> <span class="fu">s2.addBands</span>(s1);</span>
<span id="cb8-4"><a href="mapping-mangroves-using-sentinel12.html#cb8-4" aria-hidden="true" tabindex="-1"></a>var bands <span class="ot">=</span> <span class="fu">s1s2_new.bandNames</span>();</span>
<span id="cb8-5"><a href="mapping-mangroves-using-sentinel12.html#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(s1s2_new, <span class="st">&#39;s1s2_new&#39;</span>);</span></code></pre></div>
<p>Once I have the final set of predictors we can apply a object-based classifier.</p>
<p>Object-based classifiers are more robust than conventional pixel-based analysis. We used the SNIC algorithm to detect clusters using the Mangroves Vegetation Index (MVI). See article <a href="https://www.sciencedirect.com/science/article/pii/S0924271620301519?casa_token=LIFdYLRNNL0AAAAA:ZncWGMoyYsAdcQUe8C0rkW7wc7bBO-GqOH0V93xDcxo33om81YZjvPFYMzrWsW7dRl1dmigAXQ" target="_blank"><strong>here.</strong></a></p>
<p>User can modify MVI for any other index or metric. They current available indices are:
NBR, NDVI, NDMI, MNDWI, MVI, CMRI, GLCM (8 metrics). If you want to add your own index or a different that is not available yet, user should update the main library <strong>mangroves</strong>.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="mapping-mangroves-using-sentinel12.html#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="sc">/</span><span class="er">/</span><span class="co"># Define SNIC</span></span>
<span id="cb9-2"><a href="mapping-mangroves-using-sentinel12.html#cb9-2" aria-hidden="true" tabindex="-1"></a>var snic_sen1_2 <span class="ot">=</span> <span class="fu">man.snic_mangroves_sentinel</span>(<span class="fu">s1s2_new.select</span>(bands), <span class="st">&#39;MVI&#39;</span>); <span class="co">#// You can pick other index</span></span>
<span id="cb9-3"><a href="mapping-mangroves-using-sentinel12.html#cb9-3" aria-hidden="true" tabindex="-1"></a>var predictionBands<span class="ot">=</span><span class="fu">snic_sen1_2.bandNames</span>()<span class="fu">.remove</span>(<span class="st">&#39;clusters&#39;</span>);</span>
<span id="cb9-4"><a href="mapping-mangroves-using-sentinel12.html#cb9-4" aria-hidden="true" tabindex="-1"></a>snic_sen1_2 <span class="ot">=</span> <span class="fu">snic_sen1_2.select</span>(predictionBands);</span></code></pre></div>
<p>Now we can create sampled points for the five classes.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="mapping-mangroves-using-sentinel12.html#cb10-1" aria-hidden="true" tabindex="-1"></a>var stratified <span class="ot">=</span> <span class="fu">basemap.addBands</span>(<span class="fu">ee.Image.pixelLonLat</span>())</span>
<span id="cb10-2"><a href="mapping-mangroves-using-sentinel12.html#cb10-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">.stratifiedSample</span>({</span>
<span id="cb10-3"><a href="mapping-mangroves-using-sentinel12.html#cb10-3" aria-hidden="true" tabindex="-1"></a>      numPoints<span class="sc">:</span> <span class="dv">10</span>,</span>
<span id="cb10-4"><a href="mapping-mangroves-using-sentinel12.html#cb10-4" aria-hidden="true" tabindex="-1"></a>      classBand<span class="sc">:</span> <span class="st">&#39;class&#39;</span>,</span>
<span id="cb10-5"><a href="mapping-mangroves-using-sentinel12.html#cb10-5" aria-hidden="true" tabindex="-1"></a>      scale<span class="sc">:</span> <span class="dv">20</span>,</span>
<span id="cb10-6"><a href="mapping-mangroves-using-sentinel12.html#cb10-6" aria-hidden="true" tabindex="-1"></a>      region<span class="sc">:</span> <span class="fu">snic_sen1_2.geometry</span>(), <span class="sc">/</span><span class="er">/</span>new_area, </span>
<span id="cb10-7"><a href="mapping-mangroves-using-sentinel12.html#cb10-7" aria-hidden="true" tabindex="-1"></a>      classValues<span class="sc">:</span>[<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>],   <span class="sc">/</span><span class="er">/</span>  <span class="dv">1</span><span class="ot">=</span>manglar   <span class="sc">/</span><span class="er">/</span> <span class="dv">2</span> <span class="ot">=</span> forest <span class="sc">/</span><span class="er">/</span> <span class="dv">3</span><span class="ot">=</span> nonforest  <span class="sc">/</span><span class="er">/</span><span class="dv">4</span> water <span class="sc">/</span><span class="er">/</span><span class="dv">5</span> Herbazal<span class="sc">-</span></span>
<span id="cb10-8"><a href="mapping-mangroves-using-sentinel12.html#cb10-8" aria-hidden="true" tabindex="-1"></a>      classPoints<span class="sc">:</span> [<span class="dv">1000</span>, <span class="dv">1000</span>, <span class="dv">1000</span>, <span class="dv">1000</span>, <span class="dv">500</span>],  </span>
<span id="cb10-9"><a href="mapping-mangroves-using-sentinel12.html#cb10-9" aria-hidden="true" tabindex="-1"></a>    })<span class="fu">.map</span>(<span class="cf">function</span>(f) {</span>
<span id="cb10-10"><a href="mapping-mangroves-using-sentinel12.html#cb10-10" aria-hidden="true" tabindex="-1"></a>      return <span class="fu">f.setGeometry</span>(<span class="fu">ee.Geometry.Point</span>([<span class="fu">f.get</span>(<span class="st">&#39;longitude&#39;</span>), <span class="fu">f.get</span>(<span class="st">&#39;latitude&#39;</span>)]));</span>
<span id="cb10-11"><a href="mapping-mangroves-using-sentinel12.html#cb10-11" aria-hidden="true" tabindex="-1"></a>    });</span>
<span id="cb10-12"><a href="mapping-mangroves-using-sentinel12.html#cb10-12" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span> (<span class="st">&#39;Points per class&#39;</span>, <span class="fu">stratified.reduceColumns</span>(<span class="fu">ee.Reducer.frequencyHistogram</span>(),[<span class="st">&#39;class&#39;</span>]));</span></code></pre></div>
<p>We can export the training (70%) and testing points (30%) for further improvement and export the final map with specific metadata.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="mapping-mangroves-using-sentinel12.html#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">Export.image.toAsset</span>({</span>
<span id="cb11-2"><a href="mapping-mangroves-using-sentinel12.html#cb11-2" aria-hidden="true" tabindex="-1"></a>  image<span class="sc">:</span> <span class="fu">image_classified.setMulti</span>({</span>
<span id="cb11-3"><a href="mapping-mangroves-using-sentinel12.html#cb11-3" aria-hidden="true" tabindex="-1"></a>    processing<span class="sc">:</span> <span class="st">&#39;16-03-2021&#39;</span>, <span class="sc">/</span><span class="er">/</span>Change the date </span>
<span id="cb11-4"><a href="mapping-mangroves-using-sentinel12.html#cb11-4" aria-hidden="true" tabindex="-1"></a>    comment<span class="sc">:</span><span class="st">&quot;Second S1+S2 5 classes SNIC&quot;</span>,   </span>
<span id="cb11-5"><a href="mapping-mangroves-using-sentinel12.html#cb11-5" aria-hidden="true" tabindex="-1"></a>    code<span class="sc">:</span> <span class="st">&#39;https://code.earthengine.google.com/174f2b05945fd70898de48ef6d02c4d8&#39;</span>,  <span class="sc">/</span><span class="er">/</span><span class="co">#Save the link of the code </span></span>
<span id="cb11-6"><a href="mapping-mangroves-using-sentinel12.html#cb11-6" aria-hidden="true" tabindex="-1"></a>    user<span class="sc">:</span> <span class="st">&#39;PauloJ&#39;</span>, </span>
<span id="cb11-7"><a href="mapping-mangroves-using-sentinel12.html#cb11-7" aria-hidden="true" tabindex="-1"></a>  }),</span>
<span id="cb11-8"><a href="mapping-mangroves-using-sentinel12.html#cb11-8" aria-hidden="true" tabindex="-1"></a>  description<span class="sc">:</span> <span class="st">&#39;S1S2_classification_SNIC&#39;</span>,</span>
<span id="cb11-9"><a href="mapping-mangroves-using-sentinel12.html#cb11-9" aria-hidden="true" tabindex="-1"></a>  scale<span class="sc">:</span> <span class="dv">20</span>,</span>
<span id="cb11-10"><a href="mapping-mangroves-using-sentinel12.html#cb11-10" aria-hidden="true" tabindex="-1"></a>  assetId<span class="sc">:</span> <span class="st">&#39;SilviaCarbon_COL/S1S2_2019_2020/S1S2_class_SNIC_R2&#39;</span>,</span>
<span id="cb11-11"><a href="mapping-mangroves-using-sentinel12.html#cb11-11" aria-hidden="true" tabindex="-1"></a>  region<span class="sc">:</span> <span class="fu">image_classified.geometry</span>(), <span class="sc">/</span><span class="er">/</span>new_area</span>
<span id="cb11-12"><a href="mapping-mangroves-using-sentinel12.html#cb11-12" aria-hidden="true" tabindex="-1"></a>  maxPixels<span class="sc">:</span> <span class="fl">1e13</span></span>
<span id="cb11-13"><a href="mapping-mangroves-using-sentinel12.html#cb11-13" aria-hidden="true" tabindex="-1"></a>})</span></code></pre></div>
</div>
<div id="accuracy-and-cleaning-the-final-product" class="section level2" number="2.4">
<h2><span class="header-section-number">2.4</span> Accuracy and cleaning the final product</h2>
<p>A basic accuracy assessment using the testing points help us to understand how well the classification process performs.
See code <strong>3.Accuracy_test_S1_S2</strong></p>
<p>Finally, post-processing is needed to clean out final map. Using the Digital Elevation model
and some geometries for the Caribbean and Pacific regions were used to produce the final map.
See code <strong>4.Cleaning S1_S2_classification</strong></p>
<div class="figure"><span id="fig:my-fig2"></span>
<img src="images/s1s2_gif.gif" alt="Buenaventura classification" width="650px" />
<p class="caption">
Figure 2.1: Buenaventura classification
</p>
</div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="mapping-mangroves-using-landsat.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/2sentinel.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/paulomur/mangroves/edit/master/2sentinel.Rmd",
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
