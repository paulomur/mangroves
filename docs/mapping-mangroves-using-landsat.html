<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>3 Mapping mangroves using Landsat | Mapping mangroves using remote sensing</title>
  <meta name="description" content="3 Mapping mangroves using Landsat | Mapping mangroves using remote sensing" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="3 Mapping mangroves using Landsat | Mapping mangroves using remote sensing" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="3 Mapping mangroves using Landsat | Mapping mangroves using remote sensing" />
  
  
  

<meta name="author" content="Paulo J. Murillo-Sandoval" />


<meta name="date" content="2021-04-13" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="mapping-mangroves-using-sentinel12.html"/>

<script src="libs/header-attrs-2.7/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Mangroves Science</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Overview</a></li>
<li class="chapter" data-level="2" data-path="mapping-mangroves-using-sentinel12.html"><a href="mapping-mangroves-using-sentinel12.html"><i class="fa fa-check"></i><b>2</b> Mapping mangroves using Sentinel1&amp;2</a>
<ul>
<li class="chapter" data-level="2.1" data-path="mapping-mangroves-using-sentinel12.html"><a href="mapping-mangroves-using-sentinel12.html#preprocessingexporting-sentinel-1-and-sentinel-2"><i class="fa fa-check"></i><b>2.1</b> Preprocessing/Exporting Sentinel-1 and Sentinel-2</a></li>
<li class="chapter" data-level="2.2" data-path="mapping-mangroves-using-sentinel12.html"><a href="mapping-mangroves-using-sentinel12.html#organizing-a-basemap-get-training-data"><i class="fa fa-check"></i><b>2.2</b> Organizing a basemap (get training data)</a></li>
<li class="chapter" data-level="2.3" data-path="mapping-mangroves-using-sentinel12.html"><a href="mapping-mangroves-using-sentinel12.html#indices-and-an-object-based-classifier"><i class="fa fa-check"></i><b>2.3</b> Indices and an object-based classifier</a></li>
<li class="chapter" data-level="2.4" data-path="mapping-mangroves-using-sentinel12.html"><a href="mapping-mangroves-using-sentinel12.html#accuracy-and-cleaning-the-final-product"><i class="fa fa-check"></i><b>2.4</b> Accuracy and cleaning the final product</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="mapping-mangroves-using-landsat.html"><a href="mapping-mangroves-using-landsat.html"><i class="fa fa-check"></i><b>3</b> Mapping mangroves using Landsat</a>
<ul>
<li class="chapter" data-level="3.1" data-path="mapping-mangroves-using-landsat.html"><a href="mapping-mangroves-using-landsat.html#making-fitted-values-using-landsat-archive"><i class="fa fa-check"></i><b>3.1</b> Making fitted values using Landsat archive</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="mapping-mangroves-using-landsat.html"><a href="mapping-mangroves-using-landsat.html#remove-bad-imagery"><i class="fa fa-check"></i><b>3.1.1</b> Remove bad imagery</a></li>
<li class="chapter" data-level="3.1.2" data-path="mapping-mangroves-using-landsat.html"><a href="mapping-mangroves-using-landsat.html#input-parameters-1"><i class="fa fa-check"></i><b>3.1.2</b> Input parameters (1)</a></li>
<li class="chapter" data-level="3.1.3" data-path="mapping-mangroves-using-landsat.html"><a href="mapping-mangroves-using-landsat.html#input-parameters-2"><i class="fa fa-check"></i><b>3.1.3</b> Input parameters (2)</a></li>
<li class="chapter" data-level="3.1.4" data-path="mapping-mangroves-using-landsat.html"><a href="mapping-mangroves-using-landsat.html#adding-percentiles"><i class="fa fa-check"></i><b>3.1.4</b> Adding percentiles</a></li>
<li class="chapter" data-level="3.1.5" data-path="mapping-mangroves-using-landsat.html"><a href="mapping-mangroves-using-landsat.html#exporting-assets"><i class="fa fa-check"></i><b>3.1.5</b> Exporting assets</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="mapping-mangroves-using-landsat.html"><a href="mapping-mangroves-using-landsat.html#building-3-years-landcover-maps"><i class="fa fa-check"></i><b>3.2</b> Building 3-years landcover maps</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="mapping-mangroves-using-landsat.html"><a href="mapping-mangroves-using-landsat.html#reading-landsat-spectral-data-and-stratified-sampling"><i class="fa fa-check"></i><b>3.2.1</b> Reading Landsat spectral data and stratified sampling</a></li>
<li class="chapter" data-level="3.2.2" data-path="mapping-mangroves-using-landsat.html"><a href="mapping-mangroves-using-landsat.html#apply-snic"><i class="fa fa-check"></i><b>3.2.2</b> Apply SNIC</a></li>
<li class="chapter" data-level="3.2.3" data-path="mapping-mangroves-using-landsat.html"><a href="mapping-mangroves-using-landsat.html#tunning-for-the-amount-of-trees"><i class="fa fa-check"></i><b>3.2.3</b> Tunning for the amount of trees</a></li>
<li class="chapter" data-level="3.2.4" data-path="mapping-mangroves-using-landsat.html"><a href="mapping-mangroves-using-landsat.html#apply-snic-and-export-each-land-cover-map"><i class="fa fa-check"></i><b>3.2.4</b> Apply SNIC and export each land cover map</a></li>
<li class="chapter" data-level="3.2.5" data-path="mapping-mangroves-using-landsat.html"><a href="mapping-mangroves-using-landsat.html#maps-visualization"><i class="fa fa-check"></i><b>3.2.5</b> Maps visualization</a></li>
<li class="chapter" data-level="3.2.6" data-path="mapping-mangroves-using-landsat.html"><a href="mapping-mangroves-using-landsat.html#limitations"><i class="fa fa-check"></i><b>3.2.6</b> Limitations</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://mangrovescience.org/"</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Mapping mangroves using remote sensing</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="mapping-mangroves-using-landsat" class="section level1" number="3">
<h1><span class="header-section-number">3</span> Mapping mangroves using Landsat</h1>
<p>For mapping mangroves change using Landsat our approach is a bit different than for S1+S2.</p>
<p>The Colombian Pacific is the most rainy region worldwide, consequently obtain cloud-free optical data is very difficult for this region. To improve spectral data and filling gaps for missing year I employ <a href="https://emapr.github.io/LT-GEE/landtrendr.html" target="_blank"><strong>LandTrendr</strong></a> algorithm.</p>
<p>Given the lack of images we create 3-year composites from 1985-2020 that were linearly improved using temporal segmentation from LandTrendr.</p>
<p>This Figure shows a simple way to linearly improve the original spectral data from Landsat but also
filling gaps in periods in which few observations were available. This process guarantees a much spectro-temporal stability of the data that might helps to produce better land cover land use maps</p>
<div class="figure"><span id="fig:my-fig3"></span>
<img src="images/LandTrendr.png" alt="LandTrendr segmentation example" width="450px" />
<p class="caption">
Figure 3.1: LandTrendr segmentation example
</p>
</div>
<div id="making-fitted-values-using-landsat-archive" class="section level2" number="3.1">
<h2><span class="header-section-number">3.1</span> Making fitted values using Landsat archive</h2>
<p>Landsat is a popular satellite that aids to consistently track Earth’ land surface.
In tropical areas clouds and lack of Landsat observations affect tracking evolution of changes. Using LandTrendr we improve Landsat itself through some steps:</p>
<div id="remove-bad-imagery" class="section level3" number="3.1.1">
<h3><span class="header-section-number">3.1.1</span> Remove bad imagery</h3>
<p>In some cases even after masking out clouds, some images remain with them. Those images can affect seriously the composites we finally want. Specially in coastal areas is very common to find problems with images and other artifacts. One way to remove them is comparing original image vs cloud masking image. If clouds remains after masking, we should select the image ID and remove it from the ImageCollection.</p>
<p>This process is mainly important for early years in 80 and 90’s. Given that few images are available. In somecases only one with problems can affect our final composite product.</p>
<p>Using the <strong>5. Remove bad imagery Landsat</strong> code in the repository you can identify which ones should not be included in the process.</p>
<div class="figure"><span id="fig:my-fig4"></span>
<img src="images/bad.PNG" alt="Image with remaing clouds (left), original image (right)" width="150%" />
<p class="caption">
Figure 3.2: Image with remaing clouds (left), original image (right)
</p>
</div>
<p>After you pick those images that cannot be part of the process, you can exclude using ’ not_contains’ from the
code <strong>6. Get_Fiited_data_and_Percentiles_Landsat</strong></p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="mapping-mangroves-using-landsat.html#cb12-1" aria-hidden="true" tabindex="-1"></a>var getSRcollection <span class="ot">=</span> <span class="cf">function</span>(firstYear,lastYear, startDay, endDay, sensor, box) {</span>
<span id="cb12-2"><a href="mapping-mangroves-using-landsat.html#cb12-2" aria-hidden="true" tabindex="-1"></a>  var srCollection <span class="ot">=</span> <span class="fu">ee.ImageCollection</span>(<span class="st">&#39;LANDSAT/&#39;</span><span class="sc">+</span> sensor <span class="sc">+</span> <span class="st">&#39;/C01/T1_SR&#39;</span>) <span class="sc">/</span><span class="er">/</span><span class="co"># get surface reflectance images</span></span>
<span id="cb12-3"><a href="mapping-mangroves-using-landsat.html#cb12-3" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">.filterBounds</span>(box) <span class="sc">/</span><span class="er">/</span><span class="co"># filter them by a bounding box</span></span>
<span id="cb12-4"><a href="mapping-mangroves-using-landsat.html#cb12-4" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">.filter</span>(<span class="fu">ee.Filter.calendarRange</span>(day_start,day_end,<span class="st">&#39;day_of_month&#39;</span>))</span>
<span id="cb12-5"><a href="mapping-mangroves-using-landsat.html#cb12-5" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">.filter</span>(<span class="fu">ee.Filter.calendarRange</span>(month_start,month_end,<span class="st">&#39;month&#39;</span>)) </span>
<span id="cb12-6"><a href="mapping-mangroves-using-landsat.html#cb12-6" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">.filter</span>(<span class="fu">ee.Filter.calendarRange</span>(firstYear,lastYear,<span class="st">&#39;year&#39;</span>))</span>
<span id="cb12-7"><a href="mapping-mangroves-using-landsat.html#cb12-7" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">.filterMetadata</span>(<span class="st">&#39;system:index&#39;</span>, <span class="st">&#39;not_contains&#39;</span>, <span class="st">&#39;LT04_010059_19871113&#39;</span>)}</span></code></pre></div>
</div>
<div id="input-parameters-1" class="section level3" number="3.1.2">
<h3><span class="header-section-number">3.1.2</span> Input parameters (1)</h3>
<p>Common parameters in LandTrendr includes the name of the task, region, years and others.
In this example we use NBR as main index for segmentation and the new fitted bands will be the spectral bands
from Landsat. Our fitted data outputs could be also other indices not necessarily the Landsat spectral bands. We use “Medoid” to create the composites but we can also used a targetDay. The code that includes all next steps is
<strong>6. Get_Fiited_data_and_Percentiles_Landsat</strong></p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="mapping-mangroves-using-landsat.html#cb13-1" aria-hidden="true" tabindex="-1"></a>var featureValues <span class="ot">=</span> [<span class="st">&#39;Man&#39;</span>]; <span class="sc">/</span><span class="er">/</span> Name  it is useful <span class="cf">if</span> you want to export many different regions</span>
<span id="cb13-2"><a href="mapping-mangroves-using-landsat.html#cb13-2" aria-hidden="true" tabindex="-1"></a>var featureCol <span class="ot">=</span> geometry;   <span class="sc">/</span><span class="er">/</span> Region to be exported</span>
<span id="cb13-3"><a href="mapping-mangroves-using-landsat.html#cb13-3" aria-hidden="true" tabindex="-1"></a>var featureKey <span class="ot">=</span> <span class="st">&#39;Col&#39;</span>;      <span class="sc">/</span><span class="er">/</span> Name <span class="dv">2</span> <span class="sc">/</span><span class="er">/</span> it is useful <span class="cf">if</span> you want to export many different regions</span>
<span id="cb13-4"><a href="mapping-mangroves-using-landsat.html#cb13-4" aria-hidden="true" tabindex="-1"></a>var startYear <span class="ot">=</span> <span class="dv">1985</span>; <span class="sc">/</span><span class="er">/</span> what year do you want to start the time series  </span>
<span id="cb13-5"><a href="mapping-mangroves-using-landsat.html#cb13-5" aria-hidden="true" tabindex="-1"></a>var endYear <span class="ot">=</span> <span class="dv">2020</span>; <span class="sc">/</span><span class="er">/</span> what year do you want to end the time series</span>
<span id="cb13-6"><a href="mapping-mangroves-using-landsat.html#cb13-6" aria-hidden="true" tabindex="-1"></a>var startDay <span class="ot">=</span>[<span class="st">&#39;01-01&#39;</span>]; <span class="sc">/</span><span class="er">/</span> what is the beginning of date filter <span class="sc">|</span> month<span class="sc">-</span>day</span>
<span id="cb13-7"><a href="mapping-mangroves-using-landsat.html#cb13-7" aria-hidden="true" tabindex="-1"></a>var endDay <span class="ot">=</span>  [<span class="st">&#39;12-31&#39;</span>]; <span class="sc">/</span><span class="er">/</span> what is the end of date filter <span class="sc">|</span> month<span class="sc">-</span>day</span>
<span id="cb13-8"><a href="mapping-mangroves-using-landsat.html#cb13-8" aria-hidden="true" tabindex="-1"></a>var indexList <span class="ot">=</span> [[<span class="st">&#39;NBR&#39;</span>, <span class="sc">-</span><span class="dv">1</span>, true]];  <span class="sc">/</span><span class="er">/</span> The indices to segment on and the invert coefficient</span>
<span id="cb13-9"><a href="mapping-mangroves-using-landsat.html#cb13-9" aria-hidden="true" tabindex="-1"></a>var ftvList <span class="ot">=</span> [<span class="st">&#39;B1&#39;</span>, <span class="st">&#39;B2&#39;</span>, <span class="st">&#39;B3&#39;</span>, <span class="st">&#39;B4&#39;</span>, <span class="st">&#39;B5&#39;</span>, <span class="st">&#39;B7&#39;</span>]; <span class="sc">/</span><span class="er">/</span> List of images to export</span>
<span id="cb13-10"><a href="mapping-mangroves-using-landsat.html#cb13-10" aria-hidden="true" tabindex="-1"></a>var vertList <span class="ot">=</span>[];<span class="sc">/</span><span class="er">/</span> <span class="st">&#39;YRS&#39;</span>, <span class="st">&#39;SRC&#39;</span>, <span class="st">&#39;FIT&#39;</span></span>
<span id="cb13-11"><a href="mapping-mangroves-using-landsat.html#cb13-11" aria-hidden="true" tabindex="-1"></a>var mosaicType <span class="ot">=</span> <span class="st">&quot;medoid&quot;</span>; <span class="sc">/</span><span class="er">/</span> how to make annual mosaic <span class="sc">-</span> options<span class="sc">:</span> <span class="st">&quot;medoid&quot;</span>, <span class="st">&quot;targetDay&quot;</span></span>
<span id="cb13-12"><a href="mapping-mangroves-using-landsat.html#cb13-12" aria-hidden="true" tabindex="-1"></a>var targetDay <span class="ot">=</span> null ; <span class="sc">/</span><span class="er">/</span> you can use <span class="dv">172</span> here rather than null <span class="cf">if</span> use <span class="st">&quot;targetDay&quot;</span> <span class="sc">/</span><span class="er">/</span> <span class="cf">if</span> running <span class="st">&quot;targetDay&quot;</span> mosaic, what day of year should be the target</span>
<span id="cb13-13"><a href="mapping-mangroves-using-landsat.html#cb13-13" aria-hidden="true" tabindex="-1"></a>var outProj <span class="ot">=</span> <span class="st">&#39;EPSG:32618&#39;</span>; <span class="sc">/</span><span class="er">/</span> what should the output projection be? <span class="st">&#39;EPSG:2317&#39;</span> <span class="cf">for</span> SouthAmerica</span>
<span id="cb13-14"><a href="mapping-mangroves-using-landsat.html#cb13-14" aria-hidden="true" tabindex="-1"></a>var gDriveFolder <span class="ot">=</span> <span class="st">&#39;SilviaCarbon_COL&#39;</span><span class="sc">/</span><span class="er">/</span><span class="sc">+</span>  featureKey <span class="sc">+</span> <span class="st">&#39;_&#39;</span> <span class="sc">+</span> indexList[<span class="dv">0</span>][<span class="dv">0</span>]; <span class="sc">/</span><span class="er">/</span> what is the name of the Google Drive folder that you want the outputs placed <span class="cf">in</span></span>
<span id="cb13-15"><a href="mapping-mangroves-using-landsat.html#cb13-15" aria-hidden="true" tabindex="-1"></a>var affine <span class="ot">=</span> [<span class="fl">30.0</span>, <span class="dv">0</span>, <span class="fl">15.0</span>, <span class="dv">0</span>, <span class="sc">-</span><span class="fl">30.0</span>, <span class="fl">15.0</span>];</span>
<span id="cb13-16"><a href="mapping-mangroves-using-landsat.html#cb13-16" aria-hidden="true" tabindex="-1"></a>var aoiBuffer <span class="ot">=</span> <span class="dv">30</span>; <span class="sc">/</span><span class="er">/</span><span class="dv">1</span> pixel</span></code></pre></div>
<p>This inputs can be modified to export many different regions at the same time. For instance if you have a FeatureCollection with a field called <strong>PATH_ROW</strong> and the values names are (‘7058’,‘7059’) you can export them individually as:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="mapping-mangroves-using-landsat.html#cb14-1" aria-hidden="true" tabindex="-1"></a>var featureValues <span class="ot">=</span> [<span class="st">&#39;7058&#39;</span>, <span class="st">&#39;7059&#39;</span>]; <span class="sc">/</span><span class="er">/</span> Name  it is useful <span class="cf">if</span> you want to export many different regions</span>
<span id="cb14-2"><a href="mapping-mangroves-using-landsat.html#cb14-2" aria-hidden="true" tabindex="-1"></a>var featureCol <span class="ot">=</span> yourFeatureCollection;   <span class="sc">/</span><span class="er">/</span> Region to be exported</span>
<span id="cb14-3"><a href="mapping-mangroves-using-landsat.html#cb14-3" aria-hidden="true" tabindex="-1"></a>var featureKey <span class="ot">=</span> <span class="st">&#39;PATH_ROW&#39;</span>;      <span class="sc">/</span><span class="er">/</span> Name <span class="dv">2</span> <span class="sc">/</span><span class="er">/</span> Name of the field</span>
<span id="cb14-4"><a href="mapping-mangroves-using-landsat.html#cb14-4" aria-hidden="true" tabindex="-1"></a>...</span></code></pre></div>
<p>This code has many improvements:
1) Topographic correction
2) Remove scenes borders (-2km buffer)
3) Many different vegetation indices for temporal segmentation
4) You can create composites at different intervals. But it is most
effective (computationally) for creating composites each 3 or more years.</p>
<p>More details about this on: <a href="https://emapr.github.io/LT-GEE/landtrendr.html" class="uri">https://emapr.github.io/LT-GEE/landtrendr.html</a></p>
</div>
<div id="input-parameters-2" class="section level3" number="3.1.3">
<h3><span class="header-section-number">3.1.3</span> Input parameters (2)</h3>
<p>LandTrendr works over annual composites. In some regions, it is possible to use annual observations however in the Colombian Pacific there is too few data. The only alternative is to increase the
temporal window. In this case we use three-year composites from 1985-2020. In other words we have 12 temporal periods for tracking mangroves extent and change. This code helps to create composites every one, two or any window you want.
However, if you want to change epochLen, you also have to consider changing the startYear and endYear because the epoch might not exactly match with the amount of years.</p>
<p>In this cases our startYear = 1985, endYear=2020 and our epochLen =3</p>
<div class="figure"><span id="fig:my-fig5"></span>
<img src="images/epochs.PNG" alt="Epochs" width="30%" />
<p class="caption">
Figure 3.3: Epochs
</p>
</div>
</div>
<div id="adding-percentiles" class="section level3" number="3.1.4">
<h3><span class="header-section-number">3.1.4</span> Adding percentiles</h3>
<p>Medoid is a good strategy to create our composites. However, we can add more spectral information to improve classification. Using the same code we added the Percentile 20, 80 and Standard Deviation.
Before running the code, you must create an ImageCollection in you Earth Engine account. This Collection will host all these additional information.</p>
<p>To create an ImageCollection: You can just go to Assest Tab, New, Image Collection.</p>
<div class="figure"><span id="fig:my-fig6"></span>
<img src="images/imagecol.PNG" alt="Create a ImageCollection" width="30%" />
<p class="caption">
Figure 3.4: Create a ImageCollection
</p>
</div>
<p>Once you create it you can modify the assetId name:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="mapping-mangroves-using-landsat.html#cb15-1" aria-hidden="true" tabindex="-1"></a>percentil</span>
<span id="cb15-2"><a href="mapping-mangroves-using-landsat.html#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">.aggregate_array</span>(<span class="st">&#39;composite_year&#39;</span>)</span>
<span id="cb15-3"><a href="mapping-mangroves-using-landsat.html#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="fu">.evaluate</span>(<span class="cf">function</span> (composite_year) {</span>
<span id="cb15-4"><a href="mapping-mangroves-using-landsat.html#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">composite_year.forEach</span>(<span class="cf">function</span> (year, i) {</span>
<span id="cb15-5"><a href="mapping-mangroves-using-landsat.html#cb15-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-6"><a href="mapping-mangroves-using-landsat.html#cb15-6" aria-hidden="true" tabindex="-1"></a>  var image <span class="ot">=</span> percentil</span>
<span id="cb15-7"><a href="mapping-mangroves-using-landsat.html#cb15-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">.filterMetadata</span>(<span class="st">&#39;composite_year&#39;</span>, <span class="st">&#39;equals&#39;</span>, year)</span>
<span id="cb15-8"><a href="mapping-mangroves-using-landsat.html#cb15-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">.first</span>();</span>
<span id="cb15-9"><a href="mapping-mangroves-using-landsat.html#cb15-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-10"><a href="mapping-mangroves-using-landsat.html#cb15-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">Export.image.toAsset</span>({</span>
<span id="cb15-11"><a href="mapping-mangroves-using-landsat.html#cb15-11" aria-hidden="true" tabindex="-1"></a>      image<span class="sc">:</span> image,</span>
<span id="cb15-12"><a href="mapping-mangroves-using-landsat.html#cb15-12" aria-hidden="true" tabindex="-1"></a>      description<span class="sc">:</span> <span class="st">&#39;percentiles_&#39;</span> <span class="sc">+</span> year,</span>
<span id="cb15-13"><a href="mapping-mangroves-using-landsat.html#cb15-13" aria-hidden="true" tabindex="-1"></a>      assetId<span class="sc">:</span> <span class="st">&#39;YOURCOLLECTION/percentiles_&#39;</span> <span class="sc">+</span> year, </span>
<span id="cb15-14"><a href="mapping-mangroves-using-landsat.html#cb15-14" aria-hidden="true" tabindex="-1"></a>      crs<span class="sc">:</span> outProj,</span>
<span id="cb15-15"><a href="mapping-mangroves-using-landsat.html#cb15-15" aria-hidden="true" tabindex="-1"></a>      scale<span class="sc">:</span> <span class="dv">30</span>,</span>
<span id="cb15-16"><a href="mapping-mangroves-using-landsat.html#cb15-16" aria-hidden="true" tabindex="-1"></a>      maxPixels<span class="sc">:</span> <span class="fl">1e13</span>,</span>
<span id="cb15-17"><a href="mapping-mangroves-using-landsat.html#cb15-17" aria-hidden="true" tabindex="-1"></a>      region<span class="sc">:</span> featureCol,</span>
<span id="cb15-18"><a href="mapping-mangroves-using-landsat.html#cb15-18" aria-hidden="true" tabindex="-1"></a>    });      </span>
<span id="cb15-19"><a href="mapping-mangroves-using-landsat.html#cb15-19" aria-hidden="true" tabindex="-1"></a>  });</span>
<span id="cb15-20"><a href="mapping-mangroves-using-landsat.html#cb15-20" aria-hidden="true" tabindex="-1"></a>});</span></code></pre></div>
</div>
<div id="exporting-assets" class="section level3" number="3.1.5">
<h3><span class="header-section-number">3.1.5</span> Exporting assets</h3>
<p>After you remove bad images and change parameters you can export the fitted image plus the percentiles as an ImageCollection. Given this process is very demanding computationally it might takes some minutes after you are able export the data. You should see something like this:</p>
<div class="figure"><span id="fig:my-fig7"></span>
<img src="images/tasks.PNG" alt="Tasks" width="50%" />
<p class="caption">
Figure 3.5: Tasks
</p>
</div>
<p>Note: <span style="color:red;"> When you run the code the script is going to be freeze for some seconds, Just click Wait if GEE asked you.</span>.</p>
</div>
</div>
<div id="building-3-years-landcover-maps" class="section level2" number="3.2">
<h2><span class="header-section-number">3.2</span> Building 3-years landcover maps</h2>
<p>Once you save the fitted image data and the percentiles we can combine them into a final ImageCollection to run the classification process for each 3-year composite. Open the code: <strong>7. Classification_Landsat_TimeSeries</strong></p>
<div id="reading-landsat-spectral-data-and-stratified-sampling" class="section level3" number="3.2.1">
<h3><span class="header-section-number">3.2.1</span> Reading Landsat spectral data and stratified sampling</h3>
<p>The first step in the code is put together all fitted values and percentiles in one final ImageCollection.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="mapping-mangroves-using-landsat.html#cb16-1" aria-hidden="true" tabindex="-1"></a>var ftv_values  <span class="ot">=</span>  <span class="fu">ee.Image</span>(<span class="st">&quot;projects/mangrovescience/SilviaCarbon_COL/Landsat_Predictors/Cienaga-NBR-7-19852020-01011231EPOCHS3&quot;</span>);</span>
<span id="cb16-2"><a href="mapping-mangroves-using-landsat.html#cb16-2" aria-hidden="true" tabindex="-1"></a>var percentiles <span class="ot">=</span> <span class="fu">ee.FeatureCollection</span>(<span class="st">&quot;projects/mangrovescience/SilviaCarbon_COL/Landsat_Predictors/Cienaga_Percentiles&quot;</span>);</span>
<span id="cb16-3"><a href="mapping-mangroves-using-landsat.html#cb16-3" aria-hidden="true" tabindex="-1"></a>var mangroves_SNIC <span class="ot">=</span> <span class="fu">ee.Image</span>(<span class="st">&quot;projects/mangrovescience/SilviaCarbon_COL/S1S2_2019_2020/S1S2_class_SNIC_R1_cleaned&quot;</span>);</span>
<span id="cb16-4"><a href="mapping-mangroves-using-landsat.html#cb16-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-5"><a href="mapping-mangroves-using-landsat.html#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="sc">/</span><span class="er">/</span><span class="co">#Reading our FTV composites </span></span>
<span id="cb16-6"><a href="mapping-mangroves-using-landsat.html#cb16-6" aria-hidden="true" tabindex="-1"></a>var lista <span class="ot">=</span> [<span class="st">&quot;1987&quot;</span>, <span class="st">&quot;1990&quot;</span>, <span class="st">&quot;1993&quot;</span>, <span class="st">&quot;1996&quot;</span>, <span class="st">&quot;1999&quot;</span>,</span>
<span id="cb16-7"><a href="mapping-mangroves-using-landsat.html#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;2002&quot;</span>, <span class="st">&quot;2005&quot;</span>, <span class="st">&quot;2008&quot;</span>, <span class="st">&quot;2011&quot;</span>, <span class="st">&quot;2014&quot;</span>,<span class="st">&quot;2017&quot;</span>,<span class="st">&quot;2020&quot;</span>];</span>
<span id="cb16-8"><a href="mapping-mangroves-using-landsat.html#cb16-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-9"><a href="mapping-mangroves-using-landsat.html#cb16-9" aria-hidden="true" tabindex="-1"></a>var predictors <span class="ot">=</span> <span class="fu">ee.ImageCollection</span>([]);</span>
<span id="cb16-10"><a href="mapping-mangroves-using-landsat.html#cb16-10" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb16-11"><a href="mapping-mangroves-using-landsat.html#cb16-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (var <span class="at">i =</span> <span class="dv">0</span>; i<span class="sc">&lt;</span> lista.length; i<span class="sc">++</span>){</span>
<span id="cb16-12"><a href="mapping-mangroves-using-landsat.html#cb16-12" aria-hidden="true" tabindex="-1"></a>  var year <span class="ot">=</span> lista[i];</span>
<span id="cb16-13"><a href="mapping-mangroves-using-landsat.html#cb16-13" aria-hidden="true" tabindex="-1"></a>  var ftv <span class="ot">=</span> <span class="fu">ftv_values.select</span>(<span class="st">&#39;b1_ftv_&#39;</span><span class="sc">+</span>(year), <span class="st">&#39;b2_ftv_&#39;</span><span class="sc">+</span>(year),</span>
<span id="cb16-14"><a href="mapping-mangroves-using-landsat.html#cb16-14" aria-hidden="true" tabindex="-1"></a>          <span class="st">&#39;b3_ftv_&#39;</span><span class="sc">+</span>(year),<span class="st">&#39;b4_ftv_&#39;</span><span class="sc">+</span>(year),<span class="st">&#39;b5_ftv_&#39;</span><span class="sc">+</span>(year),</span>
<span id="cb16-15"><a href="mapping-mangroves-using-landsat.html#cb16-15" aria-hidden="true" tabindex="-1"></a>          <span class="st">&#39;b7_ftv_&#39;</span><span class="sc">+</span>(year))<span class="fu">.rename</span>(<span class="st">&#39;B1&#39;</span>, <span class="st">&#39;B2&#39;</span>,<span class="st">&#39;B3&#39;</span>, <span class="st">&#39;B4&#39;</span>, <span class="st">&#39;B5&#39;</span>, <span class="st">&#39;B7&#39;</span>)</span>
<span id="cb16-16"><a href="mapping-mangroves-using-landsat.html#cb16-16" aria-hidden="true" tabindex="-1"></a>         <span class="fu">.set</span>(<span class="st">&#39;composite_year&#39;</span>, <span class="fu">ee.Number.parse</span>(year));            </span>
<span id="cb16-17"><a href="mapping-mangroves-using-landsat.html#cb16-17" aria-hidden="true" tabindex="-1"></a>predictors<span class="ot">=</span> <span class="fu">predictors.merge</span>(<span class="fu">ee.ImageCollection</span>([ftv]))}</span>
<span id="cb16-18"><a href="mapping-mangroves-using-landsat.html#cb16-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-19"><a href="mapping-mangroves-using-landsat.html#cb16-19" aria-hidden="true" tabindex="-1"></a>var filter <span class="ot">=</span> <span class="fu">ee.Filter.equals</span>({</span>
<span id="cb16-20"><a href="mapping-mangroves-using-landsat.html#cb16-20" aria-hidden="true" tabindex="-1"></a>  leftField<span class="sc">:</span> <span class="st">&#39;composite_year&#39;</span>,</span>
<span id="cb16-21"><a href="mapping-mangroves-using-landsat.html#cb16-21" aria-hidden="true" tabindex="-1"></a>  rightField<span class="sc">:</span> <span class="st">&#39;composite_year&#39;</span></span>
<span id="cb16-22"><a href="mapping-mangroves-using-landsat.html#cb16-22" aria-hidden="true" tabindex="-1"></a>});</span>
<span id="cb16-23"><a href="mapping-mangroves-using-landsat.html#cb16-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-24"><a href="mapping-mangroves-using-landsat.html#cb16-24" aria-hidden="true" tabindex="-1"></a><span class="sc">/</span><span class="er">/</span><span class="co"># Create the join.</span></span>
<span id="cb16-25"><a href="mapping-mangroves-using-landsat.html#cb16-25" aria-hidden="true" tabindex="-1"></a>var simpleJoin <span class="ot">=</span> <span class="fu">ee.Join.inner</span>();</span>
<span id="cb16-26"><a href="mapping-mangroves-using-landsat.html#cb16-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-27"><a href="mapping-mangroves-using-landsat.html#cb16-27" aria-hidden="true" tabindex="-1"></a><span class="sc">/</span><span class="er">/</span><span class="co"># Inner join</span></span>
<span id="cb16-28"><a href="mapping-mangroves-using-landsat.html#cb16-28" aria-hidden="true" tabindex="-1"></a>var innerJoin <span class="ot">=</span> <span class="fu">ee.ImageCollection</span>(<span class="fu">simpleJoin.apply</span>(predictors, percentiles, filter));</span>
<span id="cb16-29"><a href="mapping-mangroves-using-landsat.html#cb16-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-30"><a href="mapping-mangroves-using-landsat.html#cb16-30" aria-hidden="true" tabindex="-1"></a>var collection_final <span class="ot">=</span> <span class="fu">innerJoin.map</span>(<span class="cf">function</span>(feature) {</span>
<span id="cb16-31"><a href="mapping-mangroves-using-landsat.html#cb16-31" aria-hidden="true" tabindex="-1"></a>  return <span class="fu">ee.Image.cat</span>(<span class="fu">feature.get</span>(<span class="st">&#39;primary&#39;</span>), <span class="fu">feature.get</span>(<span class="st">&#39;secondary&#39;</span>));</span>
<span id="cb16-32"><a href="mapping-mangroves-using-landsat.html#cb16-32" aria-hidden="true" tabindex="-1"></a>});</span>
<span id="cb16-33"><a href="mapping-mangroves-using-landsat.html#cb16-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-34"><a href="mapping-mangroves-using-landsat.html#cb16-34" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">&#39;collection_final&#39;</span>, collection_final);</span></code></pre></div>
<p>Now we can calculate different vegetation indices, and add other ancillary information.
Also we can import the basemap from which we want to collect the spectral data. The basemap that we are going to use is the map we created using S1+S2 which is a good representation of different classes for the period 2019-2020.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="mapping-mangroves-using-landsat.html#cb17-1" aria-hidden="true" tabindex="-1"></a>var mangroves <span class="ot">=</span> <span class="fu">require</span>(<span class="st">&#39;users/murillop/mapping_mangroves:mangroves&#39;</span>);</span>
<span id="cb17-2"><a href="mapping-mangroves-using-landsat.html#cb17-2" aria-hidden="true" tabindex="-1"></a>var base_predictors <span class="ot">=</span> <span class="fu">mangroves.getAncillary</span>(); </span>
<span id="cb17-3"><a href="mapping-mangroves-using-landsat.html#cb17-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-4"><a href="mapping-mangroves-using-landsat.html#cb17-4" aria-hidden="true" tabindex="-1"></a>mangroves_SNIC <span class="ot">=</span> <span class="fu">mangroves_SNIC.clip</span>(<span class="fu">collection_final.first</span>()<span class="fu">.geometry</span>())<span class="fu">.rename</span>(<span class="st">&#39;lc&#39;</span>);</span>
<span id="cb17-5"><a href="mapping-mangroves-using-landsat.html#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="fu">Map.addLayer</span>(mangroves_SNIC, {min<span class="sc">:</span><span class="dv">1</span>, max<span class="sc">:</span><span class="dv">5</span>, palette<span class="sc">:</span> [<span class="st">&quot;red&quot;</span>,<span class="st">&quot;green&quot;</span>,<span class="st">&quot;yellow&quot;</span>,<span class="st">&quot;blue&quot;</span>, <span class="st">&quot;Chartreuse&quot;</span>]}, <span class="st">&#39;Basemap 2019-2020&#39;</span>);</span>
<span id="cb17-6"><a href="mapping-mangroves-using-landsat.html#cb17-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-7"><a href="mapping-mangroves-using-landsat.html#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="sc">/</span><span class="er">/</span>Calculate all indices and GLCM predictors</span>
<span id="cb17-8"><a href="mapping-mangroves-using-landsat.html#cb17-8" aria-hidden="true" tabindex="-1"></a>var spectral_predictors <span class="ot">=</span> <span class="fu">mangroves.doIndices2_land</span>(collection_final);</span>
<span id="cb17-9"><a href="mapping-mangroves-using-landsat.html#cb17-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-10"><a href="mapping-mangroves-using-landsat.html#cb17-10" aria-hidden="true" tabindex="-1"></a><span class="sc">/</span><span class="er">/</span>Add ancillary data</span>
<span id="cb17-11"><a href="mapping-mangroves-using-landsat.html#cb17-11" aria-hidden="true" tabindex="-1"></a>spectral_predictors <span class="ot">=</span> <span class="fu">spectral_predictors.map</span>(<span class="cf">function</span>(img){</span>
<span id="cb17-12"><a href="mapping-mangroves-using-landsat.html#cb17-12" aria-hidden="true" tabindex="-1"></a>  return <span class="fu">img.addBands</span>(base_predictors)<span class="fu">.updateMask</span>(<span class="fu">mangroves_SNIC.gt</span>(<span class="dv">0</span>))});</span>
<span id="cb17-13"><a href="mapping-mangroves-using-landsat.html#cb17-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-14"><a href="mapping-mangroves-using-landsat.html#cb17-14" aria-hidden="true" tabindex="-1"></a><span class="sc">/</span><span class="er">/</span>Select Landsat data <span class="cf">in</span> <span class="dv">2017-2020</span></span>
<span id="cb17-15"><a href="mapping-mangroves-using-landsat.html#cb17-15" aria-hidden="true" tabindex="-1"></a>var y2017_2020_pixel <span class="ot">=</span> <span class="fu">spectral_predictors.filterMetadata</span>(<span class="st">&#39;composite_year&#39;</span>, <span class="st">&quot;equals&quot;</span>, <span class="dv">2020</span>)<span class="fu">.first</span>();</span>
<span id="cb17-16"><a href="mapping-mangroves-using-landsat.html#cb17-16" aria-hidden="true" tabindex="-1"></a><span class="fu">Map.addLayer</span>(y2017_2020_pixel, {min<span class="sc">:</span><span class="dv">100</span>, max<span class="sc">:</span><span class="dv">4000</span>, bands<span class="sc">:</span>[<span class="st">&#39;B4&#39;</span>,<span class="st">&#39;B5&#39;</span>,<span class="st">&#39;B3&#39;</span>]}, <span class="st">&#39;Spectral Landsat 2017-2020&#39;</span>);</span>
<span id="cb17-17"><a href="mapping-mangroves-using-landsat.html#cb17-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-18"><a href="mapping-mangroves-using-landsat.html#cb17-18" aria-hidden="true" tabindex="-1"></a><span class="sc">/</span><span class="er">/</span>Get training data<span class="sc">/</span><span class="er">/</span></span>
<span id="cb17-19"><a href="mapping-mangroves-using-landsat.html#cb17-19" aria-hidden="true" tabindex="-1"></a>var stratified <span class="ot">=</span> <span class="fu">mangroves_SNIC.addBands</span>(<span class="fu">ee.Image.pixelLonLat</span>())</span>
<span id="cb17-20"><a href="mapping-mangroves-using-landsat.html#cb17-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">.stratifiedSample</span>({</span>
<span id="cb17-21"><a href="mapping-mangroves-using-landsat.html#cb17-21" aria-hidden="true" tabindex="-1"></a>      numPoints<span class="sc">:</span> <span class="dv">1</span>,</span>
<span id="cb17-22"><a href="mapping-mangroves-using-landsat.html#cb17-22" aria-hidden="true" tabindex="-1"></a>      classBand<span class="sc">:</span> <span class="st">&#39;lc&#39;</span>,</span>
<span id="cb17-23"><a href="mapping-mangroves-using-landsat.html#cb17-23" aria-hidden="true" tabindex="-1"></a>      scale<span class="sc">:</span> <span class="dv">30</span>,</span>
<span id="cb17-24"><a href="mapping-mangroves-using-landsat.html#cb17-24" aria-hidden="true" tabindex="-1"></a>      region<span class="sc">:</span> <span class="fu">mangroves_SNIC.geometry</span>(),</span>
<span id="cb17-25"><a href="mapping-mangroves-using-landsat.html#cb17-25" aria-hidden="true" tabindex="-1"></a>      classValues<span class="sc">:</span>[<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">5</span>], <span class="sc">/</span><span class="er">/</span>  <span class="dv">1</span><span class="ot">=</span>manglar <span class="sc">/</span><span class="er">/</span> <span class="dv">2</span> <span class="ot">=</span> forest <span class="sc">/</span><span class="er">/</span> <span class="dv">3</span><span class="ot">=</span> pastos  <span class="sc">/</span><span class="er">/</span><span class="dv">4</span> water <span class="sc">/</span><span class="er">/</span><span class="dv">5</span> Other vegetation</span>
<span id="cb17-26"><a href="mapping-mangroves-using-landsat.html#cb17-26" aria-hidden="true" tabindex="-1"></a>      classPoints<span class="sc">:</span> [<span class="dv">200</span>, <span class="dv">200</span>, <span class="dv">200</span>, <span class="dv">200</span>, <span class="dv">200</span>],  </span>
<span id="cb17-27"><a href="mapping-mangroves-using-landsat.html#cb17-27" aria-hidden="true" tabindex="-1"></a>    })<span class="fu">.map</span>(<span class="cf">function</span>(f) {</span>
<span id="cb17-28"><a href="mapping-mangroves-using-landsat.html#cb17-28" aria-hidden="true" tabindex="-1"></a>      return <span class="fu">f.setGeometry</span>(<span class="fu">ee.Geometry.Point</span>([<span class="fu">f.get</span>(<span class="st">&#39;longitude&#39;</span>), <span class="fu">f.get</span>(<span class="st">&#39;latitude&#39;</span>)]));</span>
<span id="cb17-29"><a href="mapping-mangroves-using-landsat.html#cb17-29" aria-hidden="true" tabindex="-1"></a>    });</span>
<span id="cb17-30"><a href="mapping-mangroves-using-landsat.html#cb17-30" aria-hidden="true" tabindex="-1"></a><span class="sc">/</span><span class="er">/</span><span class="fu">print</span> (<span class="st">&#39;Points per class&#39;</span>, <span class="fu">stratified.reduceColumns</span>(<span class="fu">ee.Reducer.frequencyHistogram</span>(),[<span class="st">&#39;classification&#39;</span>]));</span>
<span id="cb17-31"><a href="mapping-mangroves-using-landsat.html#cb17-31" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span> (<span class="st">&#39;Strat&#39;</span>, <span class="fu">stratified.limit</span>(<span class="dv">10</span>))   </span>
<span id="cb17-32"><a href="mapping-mangroves-using-landsat.html#cb17-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-33"><a href="mapping-mangroves-using-landsat.html#cb17-33" aria-hidden="true" tabindex="-1"></a>var new_bands <span class="ot">=</span> [<span class="st">&#39;B2&#39;</span>,<span class="st">&#39;B3&#39;</span>, <span class="st">&#39;B4&#39;</span>,<span class="st">&#39;B5&#39;</span>, <span class="st">&#39;B7&#39;</span>, </span>
<span id="cb17-34"><a href="mapping-mangroves-using-landsat.html#cb17-34" aria-hidden="true" tabindex="-1"></a>                 <span class="st">&#39;B3_p20&#39;</span>, <span class="st">&#39;B4_p20&#39;</span>,<span class="st">&#39;B5_p20&#39;</span>, <span class="st">&#39;B7_p20&#39;</span>, </span>
<span id="cb17-35"><a href="mapping-mangroves-using-landsat.html#cb17-35" aria-hidden="true" tabindex="-1"></a>                 <span class="st">&#39;B3_p80&#39;</span>, <span class="st">&#39;B4_p80&#39;</span>,<span class="st">&#39;B5_p80&#39;</span>, <span class="st">&#39;B7_p80&#39;</span>, </span>
<span id="cb17-36"><a href="mapping-mangroves-using-landsat.html#cb17-36" aria-hidden="true" tabindex="-1"></a>                 <span class="st">&#39;B3_stdDev&#39;</span>, <span class="st">&#39;B4_stdDev&#39;</span>,<span class="st">&#39;B5_stdDev&#39;</span>, <span class="st">&#39;B7_stdDev&#39;</span>, </span>
<span id="cb17-37"><a href="mapping-mangroves-using-landsat.html#cb17-37" aria-hidden="true" tabindex="-1"></a>                 <span class="st">&#39;NDMI&#39;</span>,<span class="st">&#39;NDFI&#39;</span>, <span class="st">&#39;TCW&#39;</span>, <span class="st">&#39;TCG&#39;</span>, <span class="st">&#39;TCA&#39;</span>, <span class="st">&#39;SHADE_NDFI&#39;</span>, <span class="st">&#39;GV_NDFI&#39;</span>, <span class="st">&#39;SOIL_NDFI&#39;</span>, <span class="st">&#39;NPV_NDFI&#39;</span>,</span>
<span id="cb17-38"><a href="mapping-mangroves-using-landsat.html#cb17-38" aria-hidden="true" tabindex="-1"></a>                 <span class="st">&#39;NDVI&#39;</span>, <span class="st">&#39;MNDWI&#39;</span>, <span class="st">&#39;MVI&#39;</span>, <span class="st">&#39;CMRI&#39;</span>, <span class="st">&#39;NBR&#39;</span>,</span>
<span id="cb17-39"><a href="mapping-mangroves-using-landsat.html#cb17-39" aria-hidden="true" tabindex="-1"></a>                 <span class="st">&#39;GRAY_savg&#39;</span>, <span class="st">&#39;GRAY_var&#39;</span>, <span class="st">&#39;GRAY_ent&#39;</span>, <span class="st">&#39;GRAY_contrast&#39;</span>,</span>
<span id="cb17-40"><a href="mapping-mangroves-using-landsat.html#cb17-40" aria-hidden="true" tabindex="-1"></a>                 <span class="st">&#39;ELEVATION&#39;</span>, <span class="st">&#39;DEM_SLOPE&#39;</span> , <span class="st">&#39;ASPECT&#39;</span>,  <span class="st">&#39;TEMPERATURE&#39;</span>, <span class="st">&#39;NIGHT_LIGHTS&#39;</span>, <span class="st">&#39;POPULATION&#39;</span>];</span></code></pre></div>
<p>We distributed 200 per each class. See example of the distribution:</p>
<div class="figure"><span id="fig:my-fig8"></span>
<img src="images/cienaga.PNG" alt="Sampled points over Landsat composite 2017-2020" width="450px" />
<p class="caption">
Figure 3.6: Sampled points over Landsat composite 2017-2020
</p>
</div>
</div>
<div id="apply-snic" class="section level3" number="3.2.2">
<h3><span class="header-section-number">3.2.2</span> Apply SNIC</h3>
<p>We use Image Segmentation SNIC algorithm for classification. For building the clusters we use MVI, it is performs well for delineating mangroves extent. You can use other indices. Currently the available indices are:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="mapping-mangroves-using-landsat.html#cb18-1" aria-hidden="true" tabindex="-1"></a>[<span class="st">&#39;NDMI&#39;</span>,<span class="st">&#39;NDFI&#39;</span>, <span class="st">&#39;TCW&#39;</span>, <span class="st">&#39;TCG&#39;</span>, <span class="st">&#39;TCA&#39;</span>, <span class="st">&#39;SHADE_NDFI&#39;</span>, <span class="st">&#39;GV_NDFI&#39;</span>,</span>
<span id="cb18-2"><a href="mapping-mangroves-using-landsat.html#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="st">&#39;SOIL_NDFI&#39;</span>, <span class="st">&#39;NPV_NDFI&#39;</span>, <span class="st">&#39;NDVI&#39;</span>, <span class="st">&#39;MNDWI&#39;</span>, <span class="st">&#39;MVI&#39;</span>, <span class="st">&#39;CMRI&#39;</span>, <span class="st">&#39;NBR&#39;</span>] </span></code></pre></div>
<p>However you can add your own indices once you save the main library (‘users/murillop/NASA_mangroves:mangroves’);
in your own repository.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="mapping-mangroves-using-landsat.html#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="sc">/</span><span class="er">/</span>Use MVI <span class="cf">for</span> clustering  and spectralmap <span class="cf">in</span> <span class="fl">2020.</span>             </span>
<span id="cb19-2"><a href="mapping-mangroves-using-landsat.html#cb19-2" aria-hidden="true" tabindex="-1"></a>var snic <span class="ot">=</span> <span class="fu">mangroves.snic_mangroves_col</span>(<span class="fu">spectral_predictors.select</span>(new_bands), <span class="st">&#39;MVI&#39;</span>);</span>
<span id="cb19-3"><a href="mapping-mangroves-using-landsat.html#cb19-3" aria-hidden="true" tabindex="-1"></a>var y2017_2020_snic <span class="ot">=</span> <span class="fu">snic.filterMetadata</span>(<span class="st">&#39;composite_year&#39;</span>, <span class="st">&quot;equals&quot;</span>, <span class="dv">2020</span>)<span class="fu">.first</span>();</span>
<span id="cb19-4"><a href="mapping-mangroves-using-landsat.html#cb19-4" aria-hidden="true" tabindex="-1"></a>var predictionBands<span class="ot">=</span><span class="fu">y2017_2020_snic.bandNames</span>()<span class="fu">.remove</span>(<span class="st">&#39;clusters&#39;</span>);</span>
<span id="cb19-5"><a href="mapping-mangroves-using-landsat.html#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span> (predictionBands, <span class="st">&#39;predictionBands&#39;</span>);</span>
<span id="cb19-6"><a href="mapping-mangroves-using-landsat.html#cb19-6" aria-hidden="true" tabindex="-1"></a>snic <span class="ot">=</span> <span class="fu">snic.select</span>(predictionBands);</span>
<span id="cb19-7"><a href="mapping-mangroves-using-landsat.html#cb19-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-8"><a href="mapping-mangroves-using-landsat.html#cb19-8" aria-hidden="true" tabindex="-1"></a>var sampleAll <span class="ot">=</span> <span class="fu">y2017_2020_snic.sampleRegions</span>({</span>
<span id="cb19-9"><a href="mapping-mangroves-using-landsat.html#cb19-9" aria-hidden="true" tabindex="-1"></a>  collection<span class="sc">:</span> stratified, </span>
<span id="cb19-10"><a href="mapping-mangroves-using-landsat.html#cb19-10" aria-hidden="true" tabindex="-1"></a>  properties<span class="sc">:</span> [<span class="st">&#39;lc&#39;</span>],</span>
<span id="cb19-11"><a href="mapping-mangroves-using-landsat.html#cb19-11" aria-hidden="true" tabindex="-1"></a>  scale<span class="sc">:</span> <span class="dv">30</span>,</span>
<span id="cb19-12"><a href="mapping-mangroves-using-landsat.html#cb19-12" aria-hidden="true" tabindex="-1"></a>  tileScale<span class="sc">:</span><span class="dv">2</span>,</span>
<span id="cb19-13"><a href="mapping-mangroves-using-landsat.html#cb19-13" aria-hidden="true" tabindex="-1"></a>  geometries<span class="sc">:</span> true,</span>
<span id="cb19-14"><a href="mapping-mangroves-using-landsat.html#cb19-14" aria-hidden="true" tabindex="-1"></a>})<span class="fu">.randomColumn</span>();</span>
<span id="cb19-15"><a href="mapping-mangroves-using-landsat.html#cb19-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-16"><a href="mapping-mangroves-using-landsat.html#cb19-16" aria-hidden="true" tabindex="-1"></a><span class="sc">/</span><span class="er">/</span><span class="fu">print</span>(<span class="st">&#39;Full sample size&#39;</span>,<span class="fu">sampleAll.size</span>());</span>
<span id="cb19-17"><a href="mapping-mangroves-using-landsat.html#cb19-17" aria-hidden="true" tabindex="-1"></a>sampleAll <span class="ot">=</span> <span class="fu">sampleAll.randomColumn</span>({seed<span class="sc">:</span> <span class="dv">10</span>}); </span>
<span id="cb19-18"><a href="mapping-mangroves-using-landsat.html#cb19-18" aria-hidden="true" tabindex="-1"></a>var split <span class="ot">=</span> <span class="fl">0.7</span>;  <span class="sc">/</span><span class="er">/</span> Roughly <span class="dv">70</span><span class="sc">% training, 30%</span> testing</span>
<span id="cb19-19"><a href="mapping-mangroves-using-landsat.html#cb19-19" aria-hidden="true" tabindex="-1"></a><span class="sc">/</span><span class="er">/</span>create the training set</span>
<span id="cb19-20"><a href="mapping-mangroves-using-landsat.html#cb19-20" aria-hidden="true" tabindex="-1"></a>var trainingPts <span class="ot">=</span> <span class="fu">sampleAll.filter</span>(<span class="fu">ee.Filter.lt</span>(<span class="st">&#39;random&#39;</span>, split));<span class="sc">/</span><span class="er">/</span><span class="fu">print</span>(<span class="st">&#39;trainingPoints&#39;</span>,trainingPts);</span>
<span id="cb19-21"><a href="mapping-mangroves-using-landsat.html#cb19-21" aria-hidden="true" tabindex="-1"></a><span class="sc">/</span><span class="er">/</span><span class="fu">Export.table.toAsset</span>(trainingPts, <span class="st">&#39;train&#39;</span>, <span class="st">&#39;SilviaCarbon_COL/features/train_Landsat&#39;</span> )</span>
<span id="cb19-22"><a href="mapping-mangroves-using-landsat.html#cb19-22" aria-hidden="true" tabindex="-1"></a><span class="sc">/</span><span class="er">/</span>create the test set</span>
<span id="cb19-23"><a href="mapping-mangroves-using-landsat.html#cb19-23" aria-hidden="true" tabindex="-1"></a>var testingPts <span class="ot">=</span> <span class="fu">sampleAll.filter</span>(<span class="fu">ee.Filter.gte</span>(<span class="st">&#39;random&#39;</span>, split));<span class="sc">/</span><span class="er">/</span><span class="fu">print</span>(<span class="st">&#39;testingPoints&#39;</span>,testingPts);</span>
<span id="cb19-24"><a href="mapping-mangroves-using-landsat.html#cb19-24" aria-hidden="true" tabindex="-1"></a><span class="sc">/</span><span class="er">/</span><span class="fu">Export.table.toAsset</span>(testingPts, <span class="st">&#39;test&#39;</span>, <span class="st">&#39;SilviaCarbon_COL/features/test_Landsat&#39;</span> )</span>
<span id="cb19-25"><a href="mapping-mangroves-using-landsat.html#cb19-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-26"><a href="mapping-mangroves-using-landsat.html#cb19-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-27"><a href="mapping-mangroves-using-landsat.html#cb19-27" aria-hidden="true" tabindex="-1"></a><span class="sc">/</span><span class="er">/</span>After exporting and clean the points you can call them<span class="sc">:</span></span>
<span id="cb19-28"><a href="mapping-mangroves-using-landsat.html#cb19-28" aria-hidden="true" tabindex="-1"></a><span class="er">//</span>var train <span class="ot">=</span> <span class="fu">ee.FeatureCollection</span>(<span class="st">&#39;projects/mangrovescience/SilviaCarbon_COL/features/train_Landsat&#39;</span>);                            </span>
<span id="cb19-29"><a href="mapping-mangroves-using-landsat.html#cb19-29" aria-hidden="true" tabindex="-1"></a><span class="sc">/</span><span class="er">/</span>Otherwise just sample using random procedure<span class="sc">!</span></span>
<span id="cb19-30"><a href="mapping-mangroves-using-landsat.html#cb19-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-31"><a href="mapping-mangroves-using-landsat.html#cb19-31" aria-hidden="true" tabindex="-1"></a>var paleta<span class="ot">=</span> <span class="fu">ee.List</span>([<span class="st">&quot;ffffff&quot;</span>, <span class="st">&quot;FF0000&quot;</span>,<span class="st">&quot;00ff00 &quot;</span>, <span class="st">&quot;FFA500&quot;</span>, <span class="st">&quot;0000FF&quot;</span>, <span class="st">&quot;32CD32&quot;</span>,]); <span class="sc">/</span><span class="er">/</span> includes one color at the beggining  because class starts <span class="cf">in</span> <span class="dv">1</span> NOT <span class="cf">in</span> ZERO</span>
<span id="cb19-32"><a href="mapping-mangroves-using-landsat.html#cb19-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-33"><a href="mapping-mangroves-using-landsat.html#cb19-33" aria-hidden="true" tabindex="-1"></a>var features <span class="ot">=</span> <span class="fu">trainingPts.map</span>(<span class="cf">function</span>(f) {</span>
<span id="cb19-34"><a href="mapping-mangroves-using-landsat.html#cb19-34" aria-hidden="true" tabindex="-1"></a>  var klass <span class="ot">=</span> <span class="fu">f.get</span>(<span class="st">&quot;lc&quot;</span>);</span>
<span id="cb19-35"><a href="mapping-mangroves-using-landsat.html#cb19-35" aria-hidden="true" tabindex="-1"></a>  return <span class="fu">f.set</span>({style<span class="sc">:</span> {color<span class="sc">:</span> <span class="fu">paleta.get</span>(klass) }});</span>
<span id="cb19-36"><a href="mapping-mangroves-using-landsat.html#cb19-36" aria-hidden="true" tabindex="-1"></a>});</span>
<span id="cb19-37"><a href="mapping-mangroves-using-landsat.html#cb19-37" aria-hidden="true" tabindex="-1"></a><span class="fu">Map.addLayer</span>(<span class="fu">features.style</span>({styleProperty<span class="sc">:</span> <span class="st">&quot;style&quot;</span>}),{}, <span class="st">&#39;Training Points&#39;</span>, true);</span></code></pre></div>
<p>We also use 90 trees after tunning. It seems 90 provides a more stable accuracy. See next section.</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="mapping-mangroves-using-landsat.html#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="sc">/</span><span class="er">//</span>Build the RF classifer<span class="sc">:</span></span>
<span id="cb20-2"><a href="mapping-mangroves-using-landsat.html#cb20-2" aria-hidden="true" tabindex="-1"></a>var classifier_snic <span class="ot">=</span> <span class="fu">ee.Classifier.smileRandomForest</span>(<span class="dv">90</span>)<span class="fu">.setOutputMode</span>(<span class="st">&#39;CLASSIFICATION&#39;</span>)  </span>
<span id="cb20-3"><a href="mapping-mangroves-using-landsat.html#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="sc">/</span><span class="er">/</span><span class="dv">90</span> seems a good number of trees and Tunning plot</span>
<span id="cb20-4"><a href="mapping-mangroves-using-landsat.html#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">.train</span>({</span>
<span id="cb20-5"><a href="mapping-mangroves-using-landsat.html#cb20-5" aria-hidden="true" tabindex="-1"></a>  features<span class="sc">:</span>trainingPts, </span>
<span id="cb20-6"><a href="mapping-mangroves-using-landsat.html#cb20-6" aria-hidden="true" tabindex="-1"></a>  classProperty<span class="sc">:</span><span class="st">&#39;lc&#39;</span>, </span>
<span id="cb20-7"><a href="mapping-mangroves-using-landsat.html#cb20-7" aria-hidden="true" tabindex="-1"></a>  inputProperties<span class="sc">:</span> predictionBands</span>
<span id="cb20-8"><a href="mapping-mangroves-using-landsat.html#cb20-8" aria-hidden="true" tabindex="-1"></a>});</span></code></pre></div>
</div>
<div id="tunning-for-the-amount-of-trees" class="section level3" number="3.2.3">
<h3><span class="header-section-number">3.2.3</span> Tunning for the amount of trees</h3>
<p>I mimimize the number of trees to optimize computation demand. We identify the number of trees using a simple tunnin available for more detail <a href="https://courses.spatialthoughts.com/end-to-end-gee.html#hyperparameter-tuning" target="_blank"><strong>here.</strong></a></p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="mapping-mangroves-using-landsat.html#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="sc">/</span><span class="er">/</span> Run <span class="fu">.explain</span>() to see what the classifer looks like</span>
<span id="cb21-2"><a href="mapping-mangroves-using-landsat.html#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">classifier_snic.explain</span>())</span>
<span id="cb21-3"><a href="mapping-mangroves-using-landsat.html#cb21-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-4"><a href="mapping-mangroves-using-landsat.html#cb21-4" aria-hidden="true" tabindex="-1"></a>var test <span class="ot">=</span> <span class="fu">y2017_2020_snic.sampleRegions</span>({</span>
<span id="cb21-5"><a href="mapping-mangroves-using-landsat.html#cb21-5" aria-hidden="true" tabindex="-1"></a>  collection<span class="sc">:</span> testingPts,</span>
<span id="cb21-6"><a href="mapping-mangroves-using-landsat.html#cb21-6" aria-hidden="true" tabindex="-1"></a>  properties<span class="sc">:</span> [<span class="st">&#39;lc&#39;</span>],</span>
<span id="cb21-7"><a href="mapping-mangroves-using-landsat.html#cb21-7" aria-hidden="true" tabindex="-1"></a>  scale<span class="sc">:</span> <span class="dv">30</span>,</span>
<span id="cb21-8"><a href="mapping-mangroves-using-landsat.html#cb21-8" aria-hidden="true" tabindex="-1"></a>  tileScale<span class="sc">:</span> <span class="dv">2</span></span>
<span id="cb21-9"><a href="mapping-mangroves-using-landsat.html#cb21-9" aria-hidden="true" tabindex="-1"></a>});</span>
<span id="cb21-10"><a href="mapping-mangroves-using-landsat.html#cb21-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-11"><a href="mapping-mangroves-using-landsat.html#cb21-11" aria-hidden="true" tabindex="-1"></a><span class="sc">/</span><span class="er">/</span> Tune the numberOfTrees parameter.</span>
<span id="cb21-12"><a href="mapping-mangroves-using-landsat.html#cb21-12" aria-hidden="true" tabindex="-1"></a>var numTreesList <span class="ot">=</span> <span class="fu">ee.List.sequence</span>(<span class="dv">10</span>, <span class="dv">150</span>, <span class="dv">5</span>);</span>
<span id="cb21-13"><a href="mapping-mangroves-using-landsat.html#cb21-13" aria-hidden="true" tabindex="-1"></a>var accuracies <span class="ot">=</span> <span class="fu">numTreesList.map</span>(<span class="cf">function</span>(numTrees) {</span>
<span id="cb21-14"><a href="mapping-mangroves-using-landsat.html#cb21-14" aria-hidden="true" tabindex="-1"></a>  var classifier <span class="ot">=</span> <span class="fu">ee.Classifier.smileRandomForest</span>(numTrees)</span>
<span id="cb21-15"><a href="mapping-mangroves-using-landsat.html#cb21-15" aria-hidden="true" tabindex="-1"></a>      <span class="fu">.train</span>({</span>
<span id="cb21-16"><a href="mapping-mangroves-using-landsat.html#cb21-16" aria-hidden="true" tabindex="-1"></a>        features<span class="sc">:</span> trainingPts,</span>
<span id="cb21-17"><a href="mapping-mangroves-using-landsat.html#cb21-17" aria-hidden="true" tabindex="-1"></a>        classProperty<span class="sc">:</span> <span class="st">&#39;lc&#39;</span>,</span>
<span id="cb21-18"><a href="mapping-mangroves-using-landsat.html#cb21-18" aria-hidden="true" tabindex="-1"></a>        inputProperties<span class="sc">:</span> predictionBands</span>
<span id="cb21-19"><a href="mapping-mangroves-using-landsat.html#cb21-19" aria-hidden="true" tabindex="-1"></a>      });</span>
<span id="cb21-20"><a href="mapping-mangroves-using-landsat.html#cb21-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-21"><a href="mapping-mangroves-using-landsat.html#cb21-21" aria-hidden="true" tabindex="-1"></a>  <span class="sc">/</span><span class="er">/</span> Here we are classifying a table instead of an image</span>
<span id="cb21-22"><a href="mapping-mangroves-using-landsat.html#cb21-22" aria-hidden="true" tabindex="-1"></a>  <span class="sc">/</span><span class="er">/</span> Classifiers work on both images and tables</span>
<span id="cb21-23"><a href="mapping-mangroves-using-landsat.html#cb21-23" aria-hidden="true" tabindex="-1"></a>  return test</span>
<span id="cb21-24"><a href="mapping-mangroves-using-landsat.html#cb21-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">.classify</span>(classifier)</span>
<span id="cb21-25"><a href="mapping-mangroves-using-landsat.html#cb21-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">.errorMatrix</span>(<span class="st">&#39;lc&#39;</span>, <span class="st">&#39;classification&#39;</span>)</span>
<span id="cb21-26"><a href="mapping-mangroves-using-landsat.html#cb21-26" aria-hidden="true" tabindex="-1"></a>    <span class="fu">.accuracy</span>();</span>
<span id="cb21-27"><a href="mapping-mangroves-using-landsat.html#cb21-27" aria-hidden="true" tabindex="-1"></a>});</span>
<span id="cb21-28"><a href="mapping-mangroves-using-landsat.html#cb21-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-29"><a href="mapping-mangroves-using-landsat.html#cb21-29" aria-hidden="true" tabindex="-1"></a>var chart <span class="ot">=</span> <span class="fu">ui.Chart.array.values</span>({</span>
<span id="cb21-30"><a href="mapping-mangroves-using-landsat.html#cb21-30" aria-hidden="true" tabindex="-1"></a>  array<span class="sc">:</span> <span class="fu">ee.Array</span>(accuracies),</span>
<span id="cb21-31"><a href="mapping-mangroves-using-landsat.html#cb21-31" aria-hidden="true" tabindex="-1"></a>  axis<span class="sc">:</span> <span class="dv">0</span>,</span>
<span id="cb21-32"><a href="mapping-mangroves-using-landsat.html#cb21-32" aria-hidden="true" tabindex="-1"></a>  xLabels<span class="sc">:</span> numTreesList</span>
<span id="cb21-33"><a href="mapping-mangroves-using-landsat.html#cb21-33" aria-hidden="true" tabindex="-1"></a>  })<span class="fu">.setOptions</span>({</span>
<span id="cb21-34"><a href="mapping-mangroves-using-landsat.html#cb21-34" aria-hidden="true" tabindex="-1"></a>      title<span class="sc">:</span> <span class="st">&#39;Hyperparameter Tuning for the numberOfTrees Parameters&#39;</span>,</span>
<span id="cb21-35"><a href="mapping-mangroves-using-landsat.html#cb21-35" aria-hidden="true" tabindex="-1"></a>      vAxis<span class="sc">:</span> {title<span class="sc">:</span> <span class="st">&#39;Validation Accuracy&#39;</span>},</span>
<span id="cb21-36"><a href="mapping-mangroves-using-landsat.html#cb21-36" aria-hidden="true" tabindex="-1"></a>      hAxis<span class="sc">:</span> {title<span class="sc">:</span> <span class="st">&#39;Number of Tress&#39;</span>, gridlines<span class="sc">:</span> {count<span class="sc">:</span> <span class="dv">15</span>}}</span>
<span id="cb21-37"><a href="mapping-mangroves-using-landsat.html#cb21-37" aria-hidden="true" tabindex="-1"></a>  });</span>
<span id="cb21-38"><a href="mapping-mangroves-using-landsat.html#cb21-38" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(chart);</span></code></pre></div>
<div class="figure"><span id="fig:my-fig9"></span>
<img src="images/hypertunning.PNG" alt="Accuracy and amount of trees" width="450px" />
<p class="caption">
Figure 3.7: Accuracy and amount of trees
</p>
</div>
</div>
<div id="apply-snic-and-export-each-land-cover-map" class="section level3" number="3.2.4">
<h3><span class="header-section-number">3.2.4</span> Apply SNIC and export each land cover map</h3>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="mapping-mangroves-using-landsat.html#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="sc">/</span><span class="er">/</span>Full SNIC across whole <span class="fu">collection</span> (all years)</span>
<span id="cb22-2"><a href="mapping-mangroves-using-landsat.html#cb22-2" aria-hidden="true" tabindex="-1"></a>var classifiedCollection <span class="ot">=</span> snic</span>
<span id="cb22-3"><a href="mapping-mangroves-using-landsat.html#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">.map</span>(<span class="cf">function</span>(image) { </span>
<span id="cb22-4"><a href="mapping-mangroves-using-landsat.html#cb22-4" aria-hidden="true" tabindex="-1"></a>    return <span class="fu">image.classify</span>(classifier_snic)<span class="fu">.copyProperties</span>(image);</span>
<span id="cb22-5"><a href="mapping-mangroves-using-landsat.html#cb22-5" aria-hidden="true" tabindex="-1"></a>  });</span>
<span id="cb22-6"><a href="mapping-mangroves-using-landsat.html#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span> (classifiedCollection, <span class="st">&#39;classifiedCollection&#39;</span>);</span>
<span id="cb22-7"><a href="mapping-mangroves-using-landsat.html#cb22-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-8"><a href="mapping-mangroves-using-landsat.html#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="fu">Map.addLayer</span>(<span class="fu">classifiedCollection.first</span>(),{min<span class="sc">:</span><span class="dv">1</span>, max<span class="sc">:</span><span class="dv">5</span>, palette<span class="sc">:</span> [<span class="st">&quot;red&quot;</span>,<span class="st">&quot;green&quot;</span>,<span class="st">&quot;yellow&quot;</span>,<span class="st">&quot;blue&quot;</span>, <span class="st">&quot;Chartreuse&quot;</span>]}, <span class="st">&#39;1985-1987 SNIC classification&#39;</span>);</span>
<span id="cb22-9"><a href="mapping-mangroves-using-landsat.html#cb22-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-10"><a href="mapping-mangroves-using-landsat.html#cb22-10" aria-hidden="true" tabindex="-1"></a>classifiedCollection</span>
<span id="cb22-11"><a href="mapping-mangroves-using-landsat.html#cb22-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">.aggregate_array</span>(<span class="st">&#39;composite_year&#39;</span>)</span>
<span id="cb22-12"><a href="mapping-mangroves-using-landsat.html#cb22-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">.evaluate</span>(<span class="cf">function</span> (systemIndexes) {</span>
<span id="cb22-13"><a href="mapping-mangroves-using-landsat.html#cb22-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">systemIndexes.forEach</span>(<span class="cf">function</span> (year, i) {</span>
<span id="cb22-14"><a href="mapping-mangroves-using-landsat.html#cb22-14" aria-hidden="true" tabindex="-1"></a>      <span class="sc">/</span><span class="er">/</span><span class="fu">print</span>(i); <span class="sc">/</span><span class="er">/</span> This is your <span class="dv">0</span><span class="sc">-</span>based index</span>
<span id="cb22-15"><a href="mapping-mangroves-using-landsat.html#cb22-15" aria-hidden="true" tabindex="-1"></a>      var image <span class="ot">=</span> classifiedCollection</span>
<span id="cb22-16"><a href="mapping-mangroves-using-landsat.html#cb22-16" aria-hidden="true" tabindex="-1"></a>        <span class="fu">.filterMetadata</span>(<span class="st">&#39;composite_year&#39;</span>, <span class="st">&#39;equals&#39;</span>, year)</span>
<span id="cb22-17"><a href="mapping-mangroves-using-landsat.html#cb22-17" aria-hidden="true" tabindex="-1"></a>        <span class="fu">.first</span>();</span>
<span id="cb22-18"><a href="mapping-mangroves-using-landsat.html#cb22-18" aria-hidden="true" tabindex="-1"></a>      <span class="fu">Export.image.toAsset</span>({</span>
<span id="cb22-19"><a href="mapping-mangroves-using-landsat.html#cb22-19" aria-hidden="true" tabindex="-1"></a>        image<span class="sc">:</span> image,</span>
<span id="cb22-20"><a href="mapping-mangroves-using-landsat.html#cb22-20" aria-hidden="true" tabindex="-1"></a>        description<span class="sc">:</span> <span class="st">&#39;lc_&#39;</span> <span class="sc">+</span> year,</span>
<span id="cb22-21"><a href="mapping-mangroves-using-landsat.html#cb22-21" aria-hidden="true" tabindex="-1"></a>        assetId<span class="sc">:</span> <span class="st">&#39;lc_&#39;</span> <span class="sc">+</span> year,</span>
<span id="cb22-22"><a href="mapping-mangroves-using-landsat.html#cb22-22" aria-hidden="true" tabindex="-1"></a>        scale<span class="sc">:</span> <span class="dv">30</span>,</span>
<span id="cb22-23"><a href="mapping-mangroves-using-landsat.html#cb22-23" aria-hidden="true" tabindex="-1"></a>        maxPixels<span class="sc">:</span> <span class="fl">1e13</span>,</span>
<span id="cb22-24"><a href="mapping-mangroves-using-landsat.html#cb22-24" aria-hidden="true" tabindex="-1"></a>        region<span class="sc">:</span> <span class="fu">classifiedCollection.first</span>()<span class="fu">.geometry</span>(),</span>
<span id="cb22-25"><a href="mapping-mangroves-using-landsat.html#cb22-25" aria-hidden="true" tabindex="-1"></a>      });      </span>
<span id="cb22-26"><a href="mapping-mangroves-using-landsat.html#cb22-26" aria-hidden="true" tabindex="-1"></a>    });</span>
<span id="cb22-27"><a href="mapping-mangroves-using-landsat.html#cb22-27" aria-hidden="true" tabindex="-1"></a>});</span></code></pre></div>
</div>
<div id="maps-visualization" class="section level3" number="3.2.5">
<h3><span class="header-section-number">3.2.5</span> Maps visualization</h3>
<p>We created a gif to visualize the dynamics of mangroves in Cienaga Grande. Our approach provides a quick reference to evaluate mangroves potential loss and gains. While there is a high variability along time in this study region, further validation and cleaning the outputs is necessary.</p>
<p>We encourage potential users to add or remove spectral metrics and careful select training data to improve current outputs.</p>
<div class="figure"><span id="fig:myfig10"></span>
<img src="images/Fitted.gif" alt="Comparing Landsat vs Land cover maps" width="50%" /><img src="images/landcover.gif" alt="Comparing Landsat vs Land cover maps" width="50%" />
<p class="caption">
Figure 3.8: Comparing Landsat vs Land cover maps
</p>
</div>
</div>
<div id="limitations" class="section level3" number="3.2.6">
<h3><span class="header-section-number">3.2.6</span> Limitations</h3>
<p>Outcome maps for this approach will depend on the quality of your input Landsat data, basemap detail and also training data. I recommend to collect historical data from other years and limited the amount of sampled points if you use the object-based approach. For instance, in this study case we use 200 points for each class, but points could be located at the same cluster.</p>
<p>While the accuracy depends of many factors are methodology combines the current state-of-the-art elements to be repeatable and reproducible in any other part of the world.</p>
<!-- # ```{r my-fig10, out.width = "650px",fig.cap="Fitted Values Landsat time-series", echo=FALSE, message=FALSE} -->
<!-- # knitr::include_graphics("images/Fitted.gif") -->
<!-- # ``` -->
<!-- #  -->
<!-- # ```{r my-fig11, out.width = "650px",fig.cap="Landcover maps", echo=FALSE, message=FALSE} -->
<!-- # knitr::include_graphics("images/landcover.gif") -->
<!-- # ``` -->

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="mapping-mangroves-using-sentinel12.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rstudio/bookdown-demo/edit/master/3Landsat.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/paulomur/mangroves/edit/master/3Landsat.Rmd",
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
